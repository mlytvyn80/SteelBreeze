<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SteelBreeze Reference Manual: SbGeoEstimator.C Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SteelBreeze Reference Manual
   &#160;<span id="projectnumber">2.0.2</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_070a9b14bd5bd1b0373ba78839806e3d.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">SbGeoEstimator.C</div>  </div>
</div>
<div class="contents">
<a href="SbGeoEstimator_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * This file is part of SteelBreeze.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * SteelBreeze, the geodetic VLBI data analysing software.</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (C) 1998-2003 Sergei Bolotin, MAO NASU, Kiev, Ukraine.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * SteelBreeze is free software; you can redistribute it and/or modify</span>
<a name="l00009"></a>00009 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00010"></a>00010 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00011"></a>00011 <span class="comment"> * (at your option) any later version.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * SteelBreeze is distributed in the hope that it will be useful,</span>
<a name="l00014"></a>00014 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00015"></a>00015 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00016"></a>00016 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00019"></a>00019 <span class="comment"> * along with SteelBreeze; if not, write to the Free Software Foundation,</span>
<a name="l00020"></a>00020 <span class="comment"> * Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;math.h&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="SbGeoEstimator_8H.html">SbGeoEstimator.H</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="SbSetup_8H.html">SbSetup.H</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;qdir.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;qfileinfo.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;qmessagebox.h&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/*==============================================================================================*/</span>
<a name="l00035"></a>00035 <span class="comment">/*                                                                                              */</span>
<a name="l00036"></a>00036 <span class="comment">/* class SBEstimator::Group implementation                                                      */</span>
<a name="l00037"></a>00037 <span class="comment">/*                                                                                              */</span>
<a name="l00038"></a>00038 <span class="comment">/*==============================================================================================*/</span>
<a name="l00039"></a><a class="code" href="classSBEstimator_1_1Group.html#a8fc75afb2d714beed13ff2b2a35a7d33">00039</a> <a class="code" href="classSBEstimator_1_1Group.html#a8fc75afb2d714beed13ff2b2a35a7d33">SBEstimator::Group::Group</a>(<span class="keyword">const</span> <a class="code" href="classSBMJD.html">SBMJD</a>&amp; TTL_) : <a class="code" href="classSBParameterList.html">SBParameterList</a>(), <a class="code" href="classSBMJD.html">SBMJD</a>(TTL_)
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041   setAutoDelete(TRUE);
<a name="l00042"></a>00042 };
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="classSBEstimator_1_1Group.html#a28d71319d04bf69892ac757537e100a1">00044</a> <a class="code" href="classSBEstimator_1_1Group.html#a28d71319d04bf69892ac757537e100a1">SBEstimator::Group::~Group</a>()
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046 };
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="classSBEstimator_1_1Group.html#a0f0b1c5abce9ecab598a8008aba5ea5a">00048</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#abb1ed96f1e3e1e16100f6f13ce4f3fd4">SBEstimator::Group::addParameter</a>(<span class="keyword">const</span> <a class="code" href="classSBParameter.html">SBParameter</a>* <a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>) 
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050   <a class="code" href="classSBParameterList.html#a233c2782508ccd4e4feff66c36de1bab">SBParameterList::inSort</a>(P);
<a name="l00051"></a>00051 };
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classSBEstimator_1_1Group.html#a00d84daa36d3ae9bcc3b6e750b7e5a55">00053</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a9a7363f6ea4ce9f3e336018a819f4f97">SBEstimator::Group::delParameter</a>(<span class="keyword">const</span> <a class="code" href="classSBParameter.html">SBParameter</a>* <a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>) 
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   <a class="code" href="classSBParameterList.html#aa28deb2c7f7aecf938c845e5e7c07895">SBParameterList::remove</a>(P-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>());
<a name="l00056"></a>00056 };
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="classSBEstimator_1_1Group.html#acc49827414d8639f653774bf96edc3fa">00058</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator_1_1Group.html#acc49827414d8639f653774bf96edc3fa">SBEstimator::Group::beforeRun</a>(<span class="keywordtype">int</span> NumInGroups, <a class="code" href="classSBEstimator_1_1GroupList.html">GroupList</a>* groups)
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060   <span class="keywordtype">int</span> N = count();
<a name="l00061"></a>00061   <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(N, <span class="stringliteral">&quot;Z&quot;</span>);
<a name="l00062"></a>00062   R = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(N, <span class="stringliteral">&quot;R&quot;</span>);
<a name="l00063"></a>00063   CrossCorr = <span class="keyword">new</span> <a class="code" href="classQList.html">QList&lt;SBMatrix&gt;</a>;
<a name="l00064"></a>00064   CrossCorr-&gt;setAutoDelete(TRUE);
<a name="l00065"></a>00065   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=NumInGroups+1; i&lt;groups-&gt;count(); i++)
<a name="l00066"></a>00066     CrossCorr-&gt;append(<span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(N, groups-&gt;at(i)-&gt;count(), <span class="stringliteral">&quot;CrossCorr&quot;</span>));
<a name="l00067"></a>00067 };
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="classSBEstimator_1_1Group.html#ab8a1b2b423b5232377250cb0969e26fc">00069</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator_1_1Group.html#ab8a1b2b423b5232377250cb0969e26fc">SBEstimator::Group::afterRun</a>(<span class="keywordtype">int</span> <span class="comment">/*NumGroups*/</span>, <a class="code" href="classSBEstimator_1_1GroupList.html">GroupList</a>* <span class="comment">/*groups*/</span>)
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>) <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>;
<a name="l00072"></a>00072   <span class="keywordflow">if</span> (R) <span class="keyword">delete</span> R;
<a name="l00073"></a>00073   <span class="keywordflow">if</span> (CrossCorr) <span class="keyword">delete</span> CrossCorr;
<a name="l00074"></a>00074 };
<a name="l00075"></a>00075 <span class="comment">/*==============================================================================================*/</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">/*==============================================================================================*/</span>
<a name="l00080"></a>00080 <span class="comment">/*                                                                                              */</span>
<a name="l00081"></a>00081 <span class="comment">/* SBEstimator::GroupList implementation                                                        */</span>
<a name="l00082"></a>00082 <span class="comment">/*                                                                                              */</span>
<a name="l00083"></a>00083 <span class="comment">/*==============================================================================================*/</span>
<a name="l00084"></a><a class="code" href="classSBEstimator_1_1GroupList.html#aeab599cd940da1bd3b2ca9f0ca425898">00084</a> <a class="code" href="classSBEstimator_1_1GroupList.html">SBEstimator::GroupList</a>&amp; <a class="code" href="classSBEstimator_1_1GroupList.html#aeab599cd940da1bd3b2ca9f0ca425898">SBEstimator::GroupList::operator= </a>(<span class="keyword">const</span> <a class="code" href="classSBEstimator_1_1GroupList.html">SBEstimator::GroupList</a>&amp; L_)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086   setAutoDelete(TRUE);
<a name="l00087"></a>00087   <span class="keywordflow">if</span> (count()) clear();
<a name="l00088"></a>00088   
<a name="l00089"></a>00089   <span class="keywordflow">if</span> (ValByDate) <span class="keyword">delete</span> ValByDate;
<a name="l00090"></a>00090   ValByDate = <span class="keyword">new</span> QDict&lt;Group&gt;(L_.count()+20);
<a name="l00091"></a>00091   ValByDate-&gt;setAutoDelete(FALSE);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="keywordflow">if</span> (L_.count())
<a name="l00094"></a>00094     {
<a name="l00095"></a>00095       <a class="code" href="classQListIterator.html">QListIterator&lt;Group&gt;</a> it(L_);
<a name="l00096"></a>00096       <span class="keywordflow">for</span> ( ; it.current(); ++it ) 
<a name="l00097"></a>00097         inSort(<span class="keyword">new</span> <a class="code" href="classSBEstimator_1_1Group.html">Group</a>(*it.current()));
<a name="l00098"></a>00098     };
<a name="l00099"></a>00099   
<a name="l00100"></a>00100   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00101"></a>00101 };
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="classSBEstimator_1_1GroupList.html#a3db3ba4be4f3067eec5d990bdbbb472b">00103</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator_1_1GroupList.html#a3db3ba4be4f3067eec5d990bdbbb472b">SBEstimator::GroupList::inSort</a>(<span class="keyword">const</span> <a class="code" href="classSBEstimator_1_1Group.html">Group</a>* d)
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105   <span class="keywordflow">if</span> (!d)
<a name="l00106"></a>00106     <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aa6868397ac422155bb29753fbf68aced">SBLog::TIME</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: insert of empty value; failed&quot;</span>);
<a name="l00107"></a>00107   <span class="keywordflow">else</span>
<a name="l00108"></a>00108     {
<a name="l00109"></a>00109       QString l = d-&gt;<a class="code" href="classSBMJD.html#a503ad8eab15136efa52e77311b93d61a">toString</a>(<a class="code" href="classSBMJD.html#ac2ee729edf70bb2c9c9b72c382e49bcbab7e113359dd99bea49becfd36d80a625">SBMJD::F_INTERNAL</a>);
<a name="l00110"></a>00110       <span class="keywordflow">if</span> (ValByDate-&gt;find(l))
<a name="l00111"></a>00111         <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aa6868397ac422155bb29753fbf68aced">SBLog::TIME</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00112"></a>00112                    <span class="stringliteral">&quot;: cannot insert the group whith the key [&quot;</span> + l +  
<a name="l00113"></a>00113                    <span class="stringliteral">&quot;], the group already exist&quot;</span>);
<a name="l00114"></a>00114       <span class="keywordflow">else</span>
<a name="l00115"></a>00115         {
<a name="l00116"></a>00116           <a class="code" href="classQList.html">QList&lt;Group&gt;::inSort</a>(d);
<a name="l00117"></a>00117           
<a name="l00118"></a>00118           <span class="keywordflow">if</span> (ValByDate-&gt;size()&lt;=ValByDate-&gt;count())
<a name="l00119"></a>00119             ValByDate-&gt;resize(ValByDate-&gt;size() + 10);
<a name="l00120"></a>00120           ValByDate-&gt;insert(l, d);
<a name="l00121"></a>00121         };
<a name="l00122"></a>00122     };
<a name="l00123"></a>00123 };
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="classSBEstimator_1_1GroupList.html#ab7407c8a923734e30294ad1501c2f1fc">00125</a> <span class="keywordtype">bool</span> <a class="code" href="classSBEstimator_1_1GroupList.html#a112c2b3ad4b8a49cf3dc071719c674ba">SBEstimator::GroupList::remove</a>(<span class="keyword">const</span> QString&amp; key)
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127   <a class="code" href="classSBEstimator_1_1Group.html">Group</a>* d;
<a name="l00128"></a>00128   
<a name="l00129"></a>00129   <span class="keywordflow">if</span> ((d = ValByDate-&gt;<a class="code" href="classSBParameterList.html#a6c40a8e702ea45a140a6fe0ef5c95a79">find</a>(key)))
<a name="l00130"></a>00130     <span class="keywordflow">return</span> ValByDate-&gt;<a class="code" href="classSBParameterList.html#a1130e9e7d07b6f71b4fd4d9e88ab51d2">remove</a>(key) &amp;&amp; <a class="code" href="classQList.html">QList&lt;Group&gt;::remove</a>(d);
<a name="l00131"></a>00131   <span class="keywordflow">else</span>
<a name="l00132"></a>00132     {
<a name="l00133"></a>00133       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aa6868397ac422155bb29753fbf68aced">SBLog::TIME</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00134"></a>00134                  <span class="stringliteral">&quot;: cannot delete the value: cannot find the key in the dictionary&quot;</span>);
<a name="l00135"></a>00135       <span class="keywordflow">return</span> FALSE;
<a name="l00136"></a>00136     };
<a name="l00137"></a>00137 };
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="classSBEstimator_1_1GroupList.html#aa46beb6a7430ee2e190b965f44e91c65">00139</a> <span class="keywordtype">bool</span> <a class="code" href="classSBEstimator_1_1GroupList.html#a112c2b3ad4b8a49cf3dc071719c674ba">SBEstimator::GroupList::remove</a>(<span class="keyword">const</span> <a class="code" href="classSBEstimator_1_1Group.html">Group</a>* d)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141   <span class="keywordflow">if</span> (d)
<a name="l00142"></a>00142     <span class="keywordflow">return</span> ValByDate-&gt;remove(d-&gt;<a class="code" href="classSBMJD.html#a503ad8eab15136efa52e77311b93d61a">toString</a>(<a class="code" href="classSBMJD.html#ac2ee729edf70bb2c9c9b72c382e49bcbab7e113359dd99bea49becfd36d80a625">SBMJD::F_INTERNAL</a>)) &amp;&amp; <a class="code" href="classQList.html">QList&lt;Group&gt;::remove</a>(d);
<a name="l00143"></a>00143   <span class="keywordflow">else</span>
<a name="l00144"></a>00144     {
<a name="l00145"></a>00145       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aa6868397ac422155bb29753fbf68aced">SBLog::TIME</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00146"></a>00146                  <span class="stringliteral">&quot;: cannot delete the value: the value is NULL&quot;</span>);
<a name="l00147"></a>00147       <span class="keywordflow">return</span> FALSE;
<a name="l00148"></a>00148     };
<a name="l00149"></a>00149 };
<a name="l00150"></a>00150 <span class="comment">/*==============================================================================================*/</span>
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">/*==============================================================================================*/</span>
<a name="l00155"></a>00155 <span class="comment">/*                                                                                              */</span>
<a name="l00156"></a>00156 <span class="comment">/* class SBEstimator implementation                                                             */</span>
<a name="l00157"></a>00157 <span class="comment">/*                                                                                              */</span>
<a name="l00158"></a>00158 <span class="comment">/*==============================================================================================*/</span>
<a name="l00159"></a><a class="code" href="classSBEstimator.html#ab64f89e45255b73c5bd7315d281aa3fa">00159</a> <a class="code" href="classSBEstimator.html#ab64f89e45255b73c5bd7315d281aa3fa">SBEstimator::SBEstimator</a>(<a class="code" href="classSBProject.html">SBProject</a>* Prj_, <a class="code" href="classSBRunManager.html">SBRunManager</a>* RunMgr_, <a class="code" href="classSBSolution.html">SBSolution</a>* Solution_)
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161   <a class="code" href="classSBEstimator.html#a54ba92ebd96d2e213b6f6db3270ef980">IsNeedRmTemp</a>  = TRUE;
<a name="l00162"></a>00162   <a class="code" href="classSBEstimator.html#abf4ac4a0c99b7788c04142f78646e2ac">TLastProcessed</a>= <a class="code" href="SbGeoTime_8C.html#a9f66012eb507cffa918f50cbec223a8f">TZero</a>;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164   <a class="code" href="classSBEstimator.html#a39673d34e6ab1e38f20b3e27dafd4151" title="project (not an owner of);">Prj</a> = Prj_;
<a name="l00165"></a>00165   <a class="code" href="classSBEstimator.html#ab465d5a83963cb4664594fa9a6af353d" title="run manager (not an owner of);">RunMgr</a> = RunMgr_;
<a name="l00166"></a>00166   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a> = Solution_;
<a name="l00167"></a>00167   <span class="comment">//  Groups = new GroupList;</span>
<a name="l00168"></a>00168   <span class="comment">//  NewGroups = new GroupList;</span>
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <span class="comment">// check work dir:</span>
<a name="l00171"></a>00171   <a class="code" href="classSBEstimator.html#a22fd6add1738184dcc4b37d725638818">WorkDir</a> = <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#acab3b352c3603b64627531c4bfd66eca">path2Work</a>() + <a class="code" href="classSBEstimator.html#a39673d34e6ab1e38f20b3e27dafd4151" title="project (not an owner of);">Prj</a>-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>() + <span class="stringliteral">&quot;/&quot;</span>; <span class="comment">// should we replace spaces/comas/etc?</span>
<a name="l00172"></a>00172   QDir          dir;
<a name="l00173"></a>00173   <span class="keywordflow">if</span> (!dir.exists(<a class="code" href="classSBEstimator.html#a22fd6add1738184dcc4b37d725638818">WorkDir</a>) &amp;&amp; !dir.mkdir(<a class="code" href="classSBEstimator.html#a22fd6add1738184dcc4b37d725638818">WorkDir</a>))
<a name="l00174"></a>00174     {
<a name="l00175"></a>00175       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: can&#39;t create dir [&quot;</span> + <a class="code" href="classSBEstimator.html#a22fd6add1738184dcc4b37d725638818">WorkDir</a> + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00176"></a>00176       QMessageBox::critical(0, <a class="code" href="SbCompileInfo_8C.html#ac8a1bc7d26460ea8f0c41215393e7209">Version</a>.<a class="code" href="classSBVersion.html#a5a987eafaa38290d179e87b83bc81aaa">selfName</a>(), 
<a name="l00177"></a>00177                             QString(<span class="stringliteral">&quot;Can&#39;t create working dir\n &quot;</span> + <a class="code" href="classSBEstimator.html#a22fd6add1738184dcc4b37d725638818">WorkDir</a> +
<a name="l00178"></a>00178                                     <span class="stringliteral">&quot;\nfor the project [&quot;</span> + <a class="code" href="classSBEstimator.html#a39673d34e6ab1e38f20b3e27dafd4151" title="project (not an owner of);">Prj</a>-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>() + <span class="stringliteral">&quot;]&quot;</span>));
<a name="l00179"></a>00179       <span class="comment">// exit(1); ?</span>
<a name="l00180"></a>00180     };
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <a class="code" href="classSBEstimator.html#ae39f881dc1958ad63377c6e54ec896d0">pipe4Stoch</a> = NULL;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a> = 0;
<a name="l00185"></a>00185   <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a> = NULL;
<a name="l00186"></a>00186   <a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>  = NULL;
<a name="l00187"></a>00187   <a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a> = NULL;
<a name="l00188"></a>00188   <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a> = NULL;
<a name="l00189"></a>00189   <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a> = NULL;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>    = 0;
<a name="l00192"></a>00192   <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>    = NULL;
<a name="l00193"></a>00193   <a class="code" href="classSBEstimator.html#af00c4b661244386bcc34c3c1020c44fd">Y</a>     = NULL;
<a name="l00194"></a>00194   <a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a>    = NULL;
<a name="l00195"></a>00195   <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>    = NULL;
<a name="l00196"></a>00196   <a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a>    = NULL;
<a name="l00197"></a>00197   
<a name="l00198"></a>00198   <a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>    = 0;
<a name="l00199"></a>00199   <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>    = NULL;
<a name="l00200"></a>00200   <a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a>     = NULL;
<a name="l00201"></a>00201   <a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>    = NULL;
<a name="l00202"></a>00202   <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>    = NULL;
<a name="l00203"></a>00203   <a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>   = NULL;
<a name="l00204"></a>00204   <a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>    = NULL;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>    = 0;
<a name="l00207"></a>00207   <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>    = NULL;
<a name="l00208"></a>00208   <a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>     = NULL;
<a name="l00209"></a>00209   <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>    = NULL;
<a name="l00210"></a>00210   <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>    = NULL;
<a name="l00211"></a>00211   <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>   = NULL;
<a name="l00212"></a>00212   <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>   = NULL;
<a name="l00213"></a>00213   <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>    = NULL;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>    = NULL;
<a name="l00216"></a>00216   <a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a>  = NULL;
<a name="l00217"></a>00217   <a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a> = NULL;
<a name="l00218"></a>00218   <a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a> = NULL;
<a name="l00219"></a>00219   <a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a> = NULL;
<a name="l00220"></a>00220   <a class="code" href="classSBEstimator.html#ab292cd23df263897e946d361214fd7d2">Zp_s</a>  = NULL;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   <a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a> = 0;
<a name="l00223"></a>00223   <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>= NULL;
<a name="l00224"></a>00224   <a class="code" href="classSBEstimator.html#acdc81215f0e2648e157bdbbd1b981fa7">ZpCont</a>= NULL;
<a name="l00225"></a>00225   <a class="code" href="classSBEstimator.html#aaddeaa5d35bd76467427e83102f4b1d4">RpCont</a>= NULL;
<a name="l00226"></a>00226   <a class="code" href="classSBEstimator.html#abadd54d3b5c6e135257fa9a220afa1da">RpyCont</a>=NULL;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>  =NULL;
<a name="l00229"></a>00229   <a class="code" href="classSBEstimator.html#af8a7fcdb5927fd7f3e15ceabb6c45049">PAux</a>   =NULL;
<a name="l00230"></a>00230   <a class="code" href="classSBEstimator.html#a47cef43d0e89309d544fbdb84e792471">Pp_Aux</a> =NULL;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>    = 0;
<a name="l00234"></a>00234   <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>     = NULL;
<a name="l00235"></a>00235   <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>    = NULL;
<a name="l00236"></a>00236   <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>    = NULL;
<a name="l00237"></a>00237   <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>    = NULL;
<a name="l00238"></a>00238   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>     = NULL;
<a name="l00239"></a>00239 };
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="classSBEstimator.html#a87e2bedb1e9af26b8fc08c62819a27ff">00241</a> <a class="code" href="classSBEstimator.html#a87e2bedb1e9af26b8fc08c62819a27ff">SBEstimator::~SBEstimator</a>()
<a name="l00242"></a>00242 {
<a name="l00243"></a>00243   <span class="comment">// remove work dir:</span>
<a name="l00244"></a>00244   QDir d;
<a name="l00245"></a>00245   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a54ba92ebd96d2e213b6f6db3270ef980">IsNeedRmTemp</a>)
<a name="l00246"></a>00246     {
<a name="l00247"></a>00247       <span class="keywordflow">if</span> (d.exists(<a class="code" href="classSBEstimator.html#a22fd6add1738184dcc4b37d725638818">WorkDir</a>) &amp;&amp; !d.rmdir(<a class="code" href="classSBEstimator.html#a22fd6add1738184dcc4b37d725638818">WorkDir</a>))
<a name="l00248"></a>00248         <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4a6e3db46e3cb3799c95e1a3c6f5cb1719">SBLog::IO</a> | <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00249"></a>00249                    <span class="stringliteral">&quot;: cannot delete the directory [&quot;</span> + <a class="code" href="classSBEstimator.html#a22fd6add1738184dcc4b37d725638818">WorkDir</a> + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00250"></a>00250     };
<a name="l00251"></a>00251   
<a name="l00252"></a>00252   <span class="comment">//  if (Groups) delete Groups;</span>
<a name="l00253"></a>00253   <span class="comment">//  if (NewGroups) delete NewGroups;</span>
<a name="l00254"></a>00254 };
<a name="l00255"></a>00255 
<a name="l00256"></a><a class="code" href="classSBEstimator.html#a24dab07f9186f79b4ca943fb28c79b40">00256</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a24dab07f9186f79b4ca943fb28c79b40">SBEstimator::parameterListsAboutToChange</a>()
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258   <span class="comment">// move info from [R_y Z_y] to the global informaton array</span>
<a name="l00259"></a>00259   <span class="comment">//  if (Ny) moveGlobalInfo();</span>
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 };
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="classSBEstimator.html#abdc628d51da80717dc641a35b22b2b85">00263</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#abdc628d51da80717dc641a35b22b2b85">SBEstimator::parameterListsChanged</a>()
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265   <span class="comment">/*</span>
<a name="l00266"></a>00266 <span class="comment">    if (Ry) delete Ry;</span>
<a name="l00267"></a>00267 <span class="comment">    if (Zy) delete Zy;</span>
<a name="l00268"></a>00268 <span class="comment">    </span>
<a name="l00269"></a>00269 <span class="comment">    Ny = RunMgr-&gt;globalList()-&gt;count();</span>
<a name="l00270"></a>00270 <span class="comment">    Ry = new SBUpperMatrix(Ny, &quot;Ry&quot;);</span>
<a name="l00271"></a>00271 <span class="comment">    Zy = new SBVector(Ny);</span>
<a name="l00272"></a>00272 <span class="comment">    Ys = RunMgr-&gt;globalList();</span>
<a name="l00273"></a>00273 <span class="comment">    for (unsigned int i=0; i&lt;Ny; i++)</span>
<a name="l00274"></a>00274 <span class="comment">    Ry-&gt;set(i,i, 1.0/Ys-&gt;at(i)-&gt;stdDev());</span>
<a name="l00275"></a>00275 <span class="comment">  */</span>
<a name="l00276"></a>00276 };
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="classSBEstimator.html#abb1ed96f1e3e1e16100f6f13ce4f3fd4">00278</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#abb1ed96f1e3e1e16100f6f13ce4f3fd4">SBEstimator::addParameter</a>(<span class="keyword">const</span> <a class="code" href="classSBParameter.html">SBParameter</a>* <span class="comment">/*Par_*/</span>, <span class="keyword">const</span> <a class="code" href="classSBMJD.html">SBMJD</a>&amp; <span class="comment">/*TTL_*/</span>)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280   <span class="comment">//  Group             *g=NULL;</span>
<a name="l00281"></a>00281   <span class="comment">//  if ((g=NewGroups-&gt;find(TTL_))) g-&gt;addParameter(Par_);</span>
<a name="l00282"></a>00282   <span class="comment">//  else //create group</span>
<a name="l00283"></a>00283   <span class="comment">//    {</span>
<a name="l00284"></a>00284   <span class="comment">//      NewGroups-&gt;inSort(g = new Group(TTL_));</span>
<a name="l00285"></a>00285   <span class="comment">//      g-&gt;addParameter(Par_);</span>
<a name="l00286"></a>00286   <span class="comment">//      Log-&gt;write(SBLog::DBG, SBLog::ESTIMATOR, ClassName() + </span>
<a name="l00287"></a>00287   <span class="comment">//             &quot;: created the group with TTL &lt;&quot; + TTL_.toString(SBMJD::F_Short) + &quot;&gt;&quot;);</span>
<a name="l00288"></a>00288   <span class="comment">//    };</span>
<a name="l00289"></a>00289 };
<a name="l00290"></a>00290 
<a name="l00291"></a><a class="code" href="classSBEstimator.html#a9a7363f6ea4ce9f3e336018a819f4f97">00291</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a9a7363f6ea4ce9f3e336018a819f4f97">SBEstimator::delParameter</a>(<span class="keyword">const</span> <a class="code" href="classSBParameter.html">SBParameter</a>* <span class="comment">/*Par_*/</span>, <span class="keyword">const</span> <a class="code" href="classSBMJD.html">SBMJD</a>&amp; <span class="comment">/*TTL_*/</span>)
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293   <span class="comment">//  Group             *g=NULL;</span>
<a name="l00294"></a>00294   <span class="comment">//  if ((g=NewGroups-&gt;find(TTL_)))</span>
<a name="l00295"></a>00295   <span class="comment">//    {</span>
<a name="l00296"></a>00296   <span class="comment">//      g-&gt;delParameter(Par_);</span>
<a name="l00297"></a>00297   <span class="comment">//      if (!g-&gt;count()) // rm the empty group</span>
<a name="l00298"></a>00298   <span class="comment">//    {</span>
<a name="l00299"></a>00299   <span class="comment">//      NewGroups-&gt;remove(g);</span>
<a name="l00300"></a>00300   <span class="comment">//      Log-&gt;write(SBLog::DBG, SBLog::ESTIMATOR, ClassName() + </span>
<a name="l00301"></a>00301   <span class="comment">//                 &quot;: deleted the group with TTL &lt;&quot; + TTL_.toString(SBMJD::F_Short) + &quot;&gt;&quot;);</span>
<a name="l00302"></a>00302   <span class="comment">//    };</span>
<a name="l00303"></a>00303   <span class="comment">//    }</span>
<a name="l00304"></a>00304   <span class="comment">//  else //oops!</span>
<a name="l00305"></a>00305   <span class="comment">//    Log-&gt;write(SBLog::ERR, SBLog::ESTIMATOR, ClassName() + </span>
<a name="l00306"></a>00306   <span class="comment">//           &quot;: cannot delete the parameter [&quot; + Par_-&gt;name() + &quot;] from the group with TTL &lt;&quot; +</span>
<a name="l00307"></a>00307   <span class="comment">//           TTL_.toString(SBMJD::F_Short) + &quot;&gt;&quot;);</span>
<a name="l00308"></a>00308 };
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="classSBEstimator.html#a5039529633f891420baf47cc495f28e2">00310</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a5039529633f891420baf47cc495f28e2">SBEstimator::rearrangeGroups</a>()
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312   <span class="comment">//  unsigned int      i;</span>
<a name="l00313"></a>00313   <span class="comment">//  if (NewGroups &amp;&amp; NewGroups-&gt;count())</span>
<a name="l00314"></a>00314   <span class="comment">//    {</span>
<a name="l00315"></a>00315   <span class="comment">//      for (i=0; i&lt;NewGroups-&gt;count(); i++) NewGroups-&gt;at(i)-&gt;beforeRun(i, NewGroups);</span>
<a name="l00316"></a>00316   <span class="comment">//    };</span>
<a name="l00317"></a>00317   <span class="comment">//</span>
<a name="l00318"></a>00318   <span class="comment">//  if (Groups) // not the first observations</span>
<a name="l00319"></a>00319   <span class="comment">//    {</span>
<a name="l00320"></a>00320   <span class="comment">//      </span>
<a name="l00321"></a>00321   <span class="comment">//    };</span>
<a name="l00322"></a>00322 };
<a name="l00323"></a>00323 
<a name="l00324"></a><a class="code" href="classSBEstimator.html#a363bb610099e84c61c24d1b19053226d">00324</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a363bb610099e84c61c24d1b19053226d">SBEstimator::prepare4Run</a>(<a class="code" href="classSBParameterList.html">SBParameterList</a>* AllGlobalList_)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326   <a class="code" href="classSBEstimator.html#a739165a96188b2997f728a233a5dc959">Stack</a>.clear();
<a name="l00327"></a>00327   <a class="code" href="classSBEstimator.html#a739165a96188b2997f728a233a5dc959">Stack</a>.setAutoDelete(TRUE);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a> = AllGlobalList_;
<a name="l00330"></a>00330   <a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a> = <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;count();
<a name="l00331"></a>00331   <a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;ZyAll&quot;</span>);
<a name="l00332"></a>00332   <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a> = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;RyAll&quot;</span>);
<a name="l00333"></a>00333   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; i++)
<a name="l00334"></a>00334     <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(i,i, 1.0/<a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;at(i)-&gt;sigmaAPriori());
<a name="l00335"></a>00335   <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;<a class="code" href="classSBParameterList.html#a0b283cf08d72491ad2650db71522058a">clearPValues</a>();
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a> = <span class="keyword">new</span> <a class="code" href="classSBParameterList.html">SBParameterList</a>;
<a name="l00338"></a>00338   <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;setAutoDelete(FALSE);
<a name="l00339"></a>00339 };
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="classSBEstimator.html#a827a27b40935499d39551768fe4d5e3e">00341</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a827a27b40935499d39551768fe4d5e3e">SBEstimator::prepare4Local</a>(<span class="keywordtype">int</span> Nz_, <span class="keyword">const</span> <a class="code" href="classSBMJD.html">SBMJD</a>&amp; T_)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343   <a class="code" href="classSBEstimator.html#ac3b01c416ce9d685c8de0423fcf48746">TofBatch</a> = T_;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345   <span class="comment">// global parameters:</span>
<a name="l00346"></a>00346   <a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a> = <a class="code" href="classSBEstimator.html#ab465d5a83963cb4664594fa9a6af353d" title="run manager (not an owner of);">RunMgr</a>-&gt;<a class="code" href="classSBRunManager.html#a467735ac836e03a053aef2522dda9731">globalList</a>()-&gt;count();
<a name="l00347"></a>00347   <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a> = <a class="code" href="classSBEstimator.html#ab465d5a83963cb4664594fa9a6af353d" title="run manager (not an owner of);">RunMgr</a>-&gt;<a class="code" href="classSBRunManager.html#a467735ac836e03a053aef2522dda9731">globalList</a>();
<a name="l00348"></a>00348   <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a> = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>, <span class="stringliteral">&quot;Ry&quot;</span>);
<a name="l00349"></a>00349   <a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>, <span class="stringliteral">&quot;Zy&quot;</span>);
<a name="l00350"></a>00350   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l00351"></a>00351     <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(i,i, 1.0/<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;at(i)-&gt;sigmaAPriori());
<a name="l00352"></a>00352   <span class="comment">//  Ys-&gt;clearPValues(); //keeping it</span>
<a name="l00353"></a>00353   <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;<a class="code" href="classSBParameterList.html#af0f1d538cbd419798a606b82bf5ac0fa">clearPValues_aux</a>();
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <span class="comment">// local parameters:</span>
<a name="l00356"></a>00356   <a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a> = <a class="code" href="classSBEstimator.html#ab465d5a83963cb4664594fa9a6af353d" title="run manager (not an owner of);">RunMgr</a>-&gt;<a class="code" href="classSBRunManager.html#a58595b4659f59c49e71e3634b08ea5a1">localList</a>()-&gt;count();
<a name="l00357"></a>00357   <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a> = <a class="code" href="classSBEstimator.html#ab465d5a83963cb4664594fa9a6af353d" title="run manager (not an owner of);">RunMgr</a>-&gt;<a class="code" href="classSBRunManager.html#a58595b4659f59c49e71e3634b08ea5a1">localList</a>();
<a name="l00358"></a>00358   <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a> = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>, <span class="stringliteral">&quot;Rx&quot;</span>);
<a name="l00359"></a>00359   <a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>, Ny, <span class="stringliteral">&quot;Rxy&quot;</span>);
<a name="l00360"></a>00360   <a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>, <span class="stringliteral">&quot;Zx&quot;</span>);
<a name="l00361"></a>00361   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; i++)
<a name="l00362"></a>00362     <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(i,i, 1.0/<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;at(i)-&gt;sigmaAPriori());
<a name="l00363"></a>00363   <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;<a class="code" href="classSBParameterList.html#a0b283cf08d72491ad2650db71522058a">clearPValues</a>();
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <span class="comment">// stochastic parameters:</span>
<a name="l00366"></a>00366   <a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a> = <a class="code" href="classSBEstimator.html#ab465d5a83963cb4664594fa9a6af353d" title="run manager (not an owner of);">RunMgr</a>-&gt;<a class="code" href="classSBRunManager.html#a3f945df3a2c18eb825e9e11dd585eaf5">stochList</a>()-&gt;count();
<a name="l00367"></a>00367   <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a> = <a class="code" href="classSBEstimator.html#ab465d5a83963cb4664594fa9a6af353d" title="run manager (not an owner of);">RunMgr</a>-&gt;<a class="code" href="classSBRunManager.html#a3f945df3a2c18eb825e9e11dd585eaf5">stochList</a>();
<a name="l00368"></a>00368   <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a> = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, <span class="stringliteral">&quot;Rp&quot;</span>);
<a name="l00369"></a>00369   <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, Ny, <span class="stringliteral">&quot;Rpy&quot;</span>);
<a name="l00370"></a>00370   <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, Nx, <span class="stringliteral">&quot;Rpx&quot;</span>);
<a name="l00371"></a>00371   <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, <span class="stringliteral">&quot;Zp&quot;</span>);
<a name="l00372"></a>00372   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; i++)
<a name="l00373"></a>00373     <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(i,i, 1.0/<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;at(i)-&gt;sigmaAPriori());
<a name="l00374"></a>00374   <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;<a class="code" href="classSBParameterList.html#a0b283cf08d72491ad2650db71522058a">clearPValues</a>();
<a name="l00375"></a>00375   
<a name="l00376"></a>00376   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a>)
<a name="l00377"></a>00377     <a class="code" href="classSBEstimator.html#a93f085ff46cc783af1e9bffd89ad8762">mapContStochs4NewBatch</a>(T_);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379   <span class="comment">// 4smoothing:</span>
<a name="l00380"></a>00380   <a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a> = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(Np, <span class="stringliteral">&quot;Rp_s&quot;</span>);
<a name="l00381"></a>00381   <a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(Np, Np, <span class="stringliteral">&quot;Rpp_s&quot;</span>);
<a name="l00382"></a>00382   <a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(Np, Nx, <span class="stringliteral">&quot;Rpx_s&quot;</span>);
<a name="l00383"></a>00383   <a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(Np, Ny, <span class="stringliteral">&quot;Rpy_s&quot;</span>);
<a name="l00384"></a>00384   <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>   = <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(2*Np, 2*Np + Nx + Ny + 1, <span class="stringliteral">&quot;SR&quot;</span>);
<a name="l00385"></a>00385   <a class="code" href="classSBEstimator.html#ab292cd23df263897e946d361214fd7d2">Zp_s</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(Np, <span class="stringliteral">&quot;Zp_s&quot;</span>);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   <span class="comment">// data:</span>
<a name="l00388"></a>00388   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a> = Nz_ + 8;
<a name="l00389"></a>00389   <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>   = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, <span class="stringliteral">&quot;Z&quot;</span>);
<a name="l00390"></a>00390   <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>  = <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, Np, <span class="stringliteral">&quot;Ap&quot;</span>);
<a name="l00391"></a>00391   <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>  = <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, Nx, <span class="stringliteral">&quot;Ax&quot;</span>);
<a name="l00392"></a>00392   <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>  = <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, Ny, <span class="stringliteral">&quot;Ay&quot;</span>);
<a name="l00393"></a>00393   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>   = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a> + 1, <span class="stringliteral">&quot;U&quot;</span>);
<a name="l00394"></a>00394   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>  = 0; <span class="comment">// from here Nz is a count of observations</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396   <span class="comment">// check work dir (continue):</span>
<a name="l00397"></a>00397   <span class="comment">//  WorkDir4Loc = WorkDir + RunMgr-&gt;listOfCurrentSessNames() + &quot;/&quot;;</span>
<a name="l00398"></a>00398   <a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a> = <a class="code" href="classSBEstimator.html#ab465d5a83963cb4664594fa9a6af353d" title="run manager (not an owner of);">RunMgr</a>-&gt;<a class="code" href="classSBRunManager.html#a1fa61cc9f9859e63aa90ba3e43c04025">listOfCurrentSessNames</a>();
<a name="l00399"></a>00399   QDir dir;
<a name="l00400"></a>00400   <span class="keywordflow">if</span> (!dir.exists(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(<a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>)) &amp;&amp; !dir.mkdir(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(<a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>)))
<a name="l00401"></a>00401     {
<a name="l00402"></a>00402       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: can&#39;t create dir [&quot;</span> + 
<a name="l00403"></a>00403                  <a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(<a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>) + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00404"></a>00404       QMessageBox::critical(0, <a class="code" href="SbCompileInfo_8C.html#ac8a1bc7d26460ea8f0c41215393e7209">Version</a>.<a class="code" href="classSBVersion.html#a5a987eafaa38290d179e87b83bc81aaa">selfName</a>(), 
<a name="l00405"></a>00405                             QString(<span class="stringliteral">&quot;Can&#39;t create working dir\n &quot;</span> + <a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(<a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>) +
<a name="l00406"></a>00406                                     <span class="stringliteral">&quot;\nfor the project [&quot;</span> + <a class="code" href="classSBEstimator.html#a39673d34e6ab1e38f20b3e27dafd4151" title="project (not an owner of);">Prj</a>-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>() + <span class="stringliteral">&quot;]&quot;</span>));
<a name="l00407"></a>00407       <span class="comment">// exit(1); ?</span>
<a name="l00408"></a>00408     };
<a name="l00409"></a>00409   <a class="code" href="classSBEstimator.html#a9b0ef547a31b176e6fa0129144189f69">NumOfStochs</a> = 0;
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   <span class="comment">// opening the stream for saving the stochastic parameters</span>
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (Np)
<a name="l00413"></a>00413     {
<a name="l00414"></a>00414       <a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>.setName(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(<a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>) + <span class="stringliteral">&quot;stochastics.bin.gz&quot;</span>);
<a name="l00415"></a>00415       <span class="comment">//      if (!file4Stoch.open(IO_WriteOnly))</span>
<a name="l00416"></a>00416       <span class="comment">//        Log-&gt;write(SBLog::ERR, SBLog::ESTIMATOR, ClassName() + </span>
<a name="l00417"></a>00417       <span class="comment">//                   &quot;: cannot open the file [&quot; + file4Stoch.name() + &quot;]&quot;);</span>
<a name="l00418"></a>00418       <a class="code" href="classSBEstimator.html#ae39f881dc1958ad63377c6e54ec896d0">pipe4Stoch</a> = <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#aae9646a67d46986d776d5fcf5f85084c">fcList</a>()-&gt;<a class="code" href="classSBFCList.html#a38c924625cf179f31f37683ea94fb416">open4Out</a>(<a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>.name(), <a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>, <a class="code" href="classSBEstimator.html#a82c2e8d24a7000262ed78aec1eb5d46b">stream4Stoch</a>);
<a name="l00419"></a>00419       <span class="comment">//      stream4Stoch.setDevice(&amp;file4Stoch); // ready for writing...</span>
<a name="l00420"></a>00420     };
<a name="l00421"></a>00421 };
<a name="l00422"></a>00422 
<a name="l00423"></a><a class="code" href="classSBEstimator.html#a50636c7a977fcf3d6533d72f9273cb49">00423</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a50636c7a977fcf3d6533d72f9273cb49">SBEstimator::finisLocal</a>()
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425   <a class="code" href="classSBEstimator.html#a556c1beb24a2418cd39be4d90411d397">dataUpdate</a>();
<a name="l00426"></a>00426   <span class="comment">// saving the intermediate results:</span>
<a name="l00427"></a>00427   <span class="comment">// stochastic parameters:</span>
<a name="l00428"></a>00428   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>) 
<a name="l00429"></a>00429     {
<a name="l00430"></a>00430       <a class="code" href="classSBEstimator.html#a82c2e8d24a7000262ed78aec1eb5d46b">stream4Stoch</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>; <span class="comment">// save one copy of the list</span>
<a name="l00431"></a>00431       <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#aae9646a67d46986d776d5fcf5f85084c">fcList</a>()-&gt;<a class="code" href="classSBFCList.html#a5ded2843bcbc8cbf8c5435f84f9a935c">close</a>(<a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>, <a class="code" href="classSBEstimator.html#ae39f881dc1958ad63377c6e54ec896d0">pipe4Stoch</a>, <a class="code" href="classSBEstimator.html#a82c2e8d24a7000262ed78aec1eb5d46b">stream4Stoch</a>);
<a name="l00432"></a>00432       <span class="comment">//      file4Stoch.close();</span>
<a name="l00433"></a>00433       <span class="comment">//      stream4Stoch.unsetDevice();</span>
<a name="l00434"></a>00434     };
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   <span class="comment">// check for continuous stochastic parameters:</span>
<a name="l00437"></a>00437   <a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a> = 0;
<a name="l00438"></a>00438   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; i++)
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;at(i)-&gt;isAttr(<a class="code" href="classSBDerivation.html#a19607f8eddf33f7fbcc3fdaf9cd52e9bac4aff1d14cf20bbe45f253bb979ba35e" title="the parameter&#39;s info have to be propagated in future">SBDerivation::IsPropagated</a>))
<a name="l00440"></a>00440       <a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a>++;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a>)
<a name="l00443"></a>00443     <a class="code" href="classSBEstimator.html#a6177e5a36d4868bfa9718d95e9f534d4">collectContStochs4NextBatch</a>();
<a name="l00444"></a>00444   
<a name="l00445"></a>00445   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a39673d34e6ab1e38f20b3e27dafd4151" title="project (not an owner of);">Prj</a>-&gt;<a class="code" href="classSBProject.html#ad5e99c6bd88c6c29926c5ea61fbf7381">cfg</a>().<a class="code" href="classSBConfig.html#a43ed20ac3f0ef427b823e04c9ffd8059">isGenerateDSINEXes</a>())
<a name="l00446"></a>00446     <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a3a419b7458da341c5bebfee0bc26e45a">saveNormalEqs</a>(<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>, <a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a>, <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>,  <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>, <a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>, <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>, <a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>,  <a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   <span class="comment">// global parameters:</span>
<a name="l00449"></a>00449   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>)
<a name="l00450"></a>00450     <a class="code" href="classSBEstimator.html#ac55ff956af2253d9f14d60dfe508f114">moveGlobalInfo</a>();
<a name="l00451"></a>00451 
<a name="l00452"></a>00452   <span class="comment">/*</span>
<a name="l00453"></a>00453 <span class="comment">    GlobStack.push(new QString(BatchName));</span>
<a name="l00454"></a>00454 <span class="comment">    QFile       file(workDir4Loc(BatchName) + &quot;globals.bin&quot;);</span>
<a name="l00455"></a>00455 <span class="comment">    if (!file.open(IO_WriteOnly))</span>
<a name="l00456"></a>00456 <span class="comment">    Log-&gt;write(SBLog::ERR, SBLog::ESTIMATOR, ClassName() + &quot;: cannot open the file [&quot; + file.name() + &quot;]&quot;);</span>
<a name="l00457"></a>00457 <span class="comment">    QDataStream s(&amp;file);</span>
<a name="l00458"></a>00458 <span class="comment">    s &lt;&lt; *Ys &lt;&lt; *Zy &lt;&lt; *Ry &lt;&lt; *Rxy;</span>
<a name="l00459"></a>00459 <span class="comment">    file.close();</span>
<a name="l00460"></a>00460 <span class="comment">    s.unsetDevice();</span>
<a name="l00461"></a>00461 <span class="comment">  */</span>
<a name="l00462"></a>00462 
<a name="l00463"></a>00463   <span class="comment">// local parameters:</span>
<a name="l00464"></a>00464   <a class="code" href="classSBEstimator.html#a739165a96188b2997f728a233a5dc959">Stack</a>.push(<span class="keyword">new</span> QString(<a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>));
<a name="l00465"></a>00465   QFile                 file(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(<a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>) + <span class="stringliteral">&quot;locals.bin.gz&quot;</span>);
<a name="l00466"></a>00466   QDataStream           s;
<a name="l00467"></a>00467   FILE                  *pipe = <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#aae9646a67d46986d776d5fcf5f85084c">fcList</a>()-&gt;<a class="code" href="classSBFCList.html#a38c924625cf179f31f37683ea94fb416">open4Out</a>(file.name(), file, s);
<a name="l00468"></a>00468   <span class="comment">//  if (!file.open(IO_WriteOnly))</span>
<a name="l00469"></a>00469   <span class="comment">//    Log-&gt;write(SBLog::ERR, SBLog::ESTIMATOR, ClassName() + &quot;: cannot open the file [&quot; + file.name() + &quot;]&quot;);</span>
<a name="l00470"></a>00470   s &lt;&lt; *<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a> &lt;&lt; *<a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a> &lt;&lt; <a class="code" href="classSBEstimator.html#a9b0ef547a31b176e6fa0129144189f69">NumOfStochs</a> &lt;&lt; <a class="code" href="classSBEstimator.html#ac3b01c416ce9d685c8de0423fcf48746">TofBatch</a>;
<a name="l00471"></a>00471   <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#aae9646a67d46986d776d5fcf5f85084c">fcList</a>()-&gt;<a class="code" href="classSBFCList.html#a5ded2843bcbc8cbf8c5435f84f9a935c">close</a>(file, pipe, s);
<a name="l00472"></a>00472   <span class="comment">//  file.close();</span>
<a name="l00473"></a>00473   <span class="comment">//  s.unsetDevice();</span>
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 
<a name="l00476"></a>00476   <span class="comment">// freeing the memory:</span>
<a name="l00477"></a>00477   <span class="comment">// 4smoothing:</span>
<a name="l00478"></a>00478   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>;    <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>   = NULL;};
<a name="l00479"></a>00479   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a>)  {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a>;  <a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a> = NULL;};
<a name="l00480"></a>00480   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a>) {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a>; <a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a>= NULL;};
<a name="l00481"></a>00481   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a>) {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a>; <a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a>= NULL;};
<a name="l00482"></a>00482   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a>) {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a>; <a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a>= NULL;};
<a name="l00483"></a>00483   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ab292cd23df263897e946d361214fd7d2">Zp_s</a>)  {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ab292cd23df263897e946d361214fd7d2">Zp_s</a>;  <a class="code" href="classSBEstimator.html#ab292cd23df263897e946d361214fd7d2">Zp_s</a> = NULL;};
<a name="l00484"></a>00484   <span class="comment">// stochastic parameters:</span>
<a name="l00485"></a>00485   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>;    <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>   = NULL;};
<a name="l00486"></a>00486   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>;   <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>  = NULL;};
<a name="l00487"></a>00487   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>;   <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>  = NULL;};
<a name="l00488"></a>00488   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>;    <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>   = NULL;};
<a name="l00489"></a>00489   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>)     <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a> = NULL; <span class="comment">// not an owner</span>
<a name="l00490"></a>00490   Np = 0;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   <span class="comment">// local parameters:</span>
<a name="l00493"></a>00493   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>;    <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>   = NULL;};
<a name="l00494"></a>00494   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>;   <a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>  = NULL;};
<a name="l00495"></a>00495   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>;    <a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>   = NULL;};
<a name="l00496"></a>00496   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>)     <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a> = NULL; <span class="comment">// not an owner</span>
<a name="l00497"></a>00497   <a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a> = 0;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <span class="comment">// global parameters:</span>
<a name="l00500"></a>00500   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>;    <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>   = NULL;};
<a name="l00501"></a>00501   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a>;    <a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a>   = NULL;};
<a name="l00502"></a>00502   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>)     <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a> = NULL; <span class="comment">// not an owner</span>
<a name="l00503"></a>00503   <a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a> = 0;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505   <span class="comment">// data:</span>
<a name="l00506"></a>00506   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>)     {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>;     <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>    = NULL;};
<a name="l00507"></a>00507   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>;    <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>   = NULL;};
<a name="l00508"></a>00508   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>;    <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>   = NULL;};
<a name="l00509"></a>00509   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>;    <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>   = NULL;};
<a name="l00510"></a>00510   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>)     {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>;     <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>    = NULL;};
<a name="l00511"></a>00511   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>  = 0;
<a name="l00512"></a>00512 };
<a name="l00513"></a>00513 
<a name="l00514"></a><a class="code" href="classSBEstimator.html#a2a8c34f6e485f4a63123b812ba9866d4">00514</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a2a8c34f6e485f4a63123b812ba9866d4">SBEstimator::finisRun</a>()
<a name="l00515"></a>00515 {
<a name="l00516"></a>00516   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>)
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518       <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>;
<a name="l00519"></a>00519       <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a> = NULL;
<a name="l00520"></a>00520     };
<a name="l00521"></a>00521 
<a name="l00522"></a>00522   <a class="code" href="classSBEstimator.html#a1467bbdb4686f8342dc2a42e82cd89b8">solveGlobals</a>();
<a name="l00523"></a>00523 
<a name="l00524"></a>00524   <span class="comment">// global parameters (special case):</span>
<a name="l00525"></a>00525   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a>) {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a>; <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a> = NULL;};
<a name="l00526"></a>00526   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>) {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>; <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a> = NULL;};
<a name="l00527"></a>00527   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a>) {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a>; <a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a> = NULL;};
<a name="l00528"></a>00528   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>)  {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>;  <a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>  = NULL;};
<a name="l00529"></a>00529   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>)  <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a> = NULL; <span class="comment">// not an owner</span>
<a name="l00530"></a>00530   <a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a> = 0;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   <a class="code" href="classSBEstimator.html#a739165a96188b2997f728a233a5dc959">Stack</a>.clear();
<a name="l00533"></a>00533 };
<a name="l00534"></a>00534 
<a name="l00535"></a><a class="code" href="classSBEstimator.html#a1467bbdb4686f8342dc2a42e82cd89b8">00535</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a1467bbdb4686f8342dc2a42e82cd89b8">SBEstimator::solveGlobals</a>()
<a name="l00536"></a>00536 {
<a name="l00537"></a>00537   <a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>  = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;YAll&quot;</span>);
<a name="l00538"></a>00538   <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a> = <span class="keyword">new</span> <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>(<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;PyAll&quot;</span>);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: solving global parameters&quot;</span>);
<a name="l00541"></a>00541   
<a name="l00542"></a>00542   <span class="comment">// solve the parameters:</span>
<a name="l00543"></a>00543   <span class="comment">//     RyAll * YAll = ZyAll</span>
<a name="l00544"></a>00544   <a class="code" href="SbVector_8C.html#ab7f86262fafe0ccc92593a013eb131cb">Solve</a>(*<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>, *<a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>, *<a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a>);
<a name="l00545"></a>00545   <a class="code" href="SbVector_8C.html#a134f62483ef7bcd6690bf2462f67635e">RRT</a>(*<a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a>, ~*<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>);
<a name="l00546"></a>00546   <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;<a class="code" href="classSBParameterList.html#a11cff8765706e38199833b830164c7c1">updateSolution</a>(<a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>, <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a>);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   <span class="comment">// submit to the SBSolution:</span>
<a name="l00549"></a>00549   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#aeb09464fc38c018adf8e14778f05f9e1">submitGlobalParameters</a>(<a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>, <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a>);
<a name="l00550"></a>00550   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#aa171f44d9fdf410f23f562c2a7cadf0c">reportGlobalParameters</a>();
<a name="l00551"></a>00551   
<a name="l00552"></a>00552   <span class="comment">// and local parameters:</span>
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a> = <span class="keyword">new</span> <a class="code" href="classSBParameterList.html">SBParameterList</a>;
<a name="l00555"></a>00555   <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;setAutoDelete(TRUE);
<a name="l00556"></a>00556   
<a name="l00557"></a>00557   <a class="code" href="classSBEstimator.html#a9ff23a70fb7231897db286414a3f23a6">solveLocals</a>();
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>)
<a name="l00560"></a>00560     {
<a name="l00561"></a>00561       <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>;
<a name="l00562"></a>00562       <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a> = NULL;
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>)
<a name="l00566"></a>00566     {
<a name="l00567"></a>00567       <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>;
<a name="l00568"></a>00568       <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a> = NULL;
<a name="l00569"></a>00569     }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571   <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>;  <a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>=NULL;
<a name="l00572"></a>00572   <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a>; <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a>=NULL;
<a name="l00573"></a>00573 };
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="classSBEstimator.html#a9ff23a70fb7231897db286414a3f23a6">00575</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a9ff23a70fb7231897db286414a3f23a6">SBEstimator::solveLocals</a>()
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577   <span class="keywordflow">while</span> (!<a class="code" href="classSBEstimator.html#a739165a96188b2997f728a233a5dc959">Stack</a>.isEmpty())
<a name="l00578"></a>00578     {
<a name="l00579"></a>00579       QString   *wd=<a class="code" href="classSBEstimator.html#a739165a96188b2997f728a233a5dc959">Stack</a>.pop();
<a name="l00580"></a>00580       QDir      dir;
<a name="l00581"></a>00581 
<a name="l00582"></a>00582       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a298ea789cd50be8f8ad6f9a64fe94a3c">prepare4Batch</a>(*wd);
<a name="l00583"></a>00583 
<a name="l00584"></a>00584       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00585"></a>00585                  <span class="stringliteral">&quot;: solving local parameters in the directory [&quot;</span> + <a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(*wd) + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587       <span class="comment">// read the list of parameters, vectors and matrices:</span>
<a name="l00588"></a>00588       QFile                     file(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(*wd) + <span class="stringliteral">&quot;locals.bin.gz&quot;</span>);
<a name="l00589"></a>00589       QDataStream               s;
<a name="l00590"></a>00590       FILE                      *pipe = <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#aae9646a67d46986d776d5fcf5f85084c">fcList</a>()-&gt;<a class="code" href="classSBFCList.html#ac5d0d2479b14509ab42847bfd3ad7bd9">open4In</a>(file.name(), file, s);
<a name="l00591"></a>00591       <span class="comment">//      if (!file.open(IO_ReadOnly))</span>
<a name="l00592"></a>00592       <span class="comment">//        Log-&gt;write(SBLog::ERR, SBLog::ESTIMATOR, ClassName() + </span>
<a name="l00593"></a>00593       <span class="comment">//        &quot;: cannot open the file [&quot; + file.name() + &quot;]&quot;);</span>
<a name="l00594"></a>00594       <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a> = <span class="keyword">new</span> <a class="code" href="classSBParameterList.html">SBParameterList</a>;
<a name="l00595"></a>00595       <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;setAutoDelete(TRUE);
<a name="l00596"></a>00596       <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a> = <span class="keyword">new</span> <a class="code" href="classSBParameterList.html">SBParameterList</a>;
<a name="l00597"></a>00597       <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;setAutoDelete(TRUE);
<a name="l00598"></a>00598       <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a> = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>;
<a name="l00599"></a>00599       <a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>;
<a name="l00600"></a>00600       <a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>;
<a name="l00601"></a>00601       s &gt;&gt; *<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a> &gt;&gt; <a class="code" href="classSBEstimator.html#a9b0ef547a31b176e6fa0129144189f69">NumOfStochs</a> &gt;&gt; <a class="code" href="classSBEstimator.html#ac3b01c416ce9d685c8de0423fcf48746">TofBatch</a>;
<a name="l00602"></a>00602       <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#aae9646a67d46986d776d5fcf5f85084c">fcList</a>()-&gt;<a class="code" href="classSBFCList.html#a5ded2843bcbc8cbf8c5435f84f9a935c">close</a>(file, pipe, s);
<a name="l00603"></a>00603       <span class="comment">//      file.close();</span>
<a name="l00604"></a>00604       <span class="comment">//      s.unsetDevice();</span>
<a name="l00605"></a>00605 
<a name="l00606"></a>00606       <span class="comment">// rm the temporary file:</span>
<a name="l00607"></a>00607       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a54ba92ebd96d2e213b6f6db3270ef980">IsNeedRmTemp</a>)
<a name="l00608"></a>00608         {
<a name="l00609"></a>00609           <span class="keywordflow">if</span> (dir.exists(file.name()) &amp;&amp; !dir.remove(file.name()))
<a name="l00610"></a>00610             <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4a6e3db46e3cb3799c95e1a3c6f5cb1719">SBLog::IO</a> | <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00611"></a>00611                        <span class="stringliteral">&quot;: cannot delete the file [&quot;</span> + file.name() + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00612"></a>00612         };
<a name="l00613"></a>00613       
<a name="l00614"></a>00614       <a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a> = <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;count();
<a name="l00615"></a>00615       <a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a>  = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>, <span class="stringliteral">&quot;X&quot;</span>);
<a name="l00616"></a>00616       <a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a> = <span class="keyword">new</span> <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>(<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>, <span class="stringliteral">&quot;Px&quot;</span>);
<a name="l00617"></a>00617       <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a> *RxInv = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>, <span class="stringliteral">&quot;Inverse of Rx&quot;</span>);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619       <a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a> = <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;count();
<a name="l00620"></a>00620       <a class="code" href="classSBEstimator.html#af00c4b661244386bcc34c3c1020c44fd">Y</a>  = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>, <span class="stringliteral">&quot;Y&quot;</span>);
<a name="l00621"></a>00621       <a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a> = <span class="keyword">new</span> <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>(<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>, <span class="stringliteral">&quot;Py&quot;</span>);
<a name="l00622"></a>00622       
<a name="l00623"></a>00623       <span class="comment">// mapping of YAll into Y:</span>
<a name="l00624"></a>00624       <a class="code" href="classSBParameter.html">SBParameter</a>       *Par;
<a name="l00625"></a>00625       <span class="keywordtype">int</span>               *Idx = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>], idx;        <span class="comment">// an indixes of elements of Ys into YsAll</span>
<a name="l00626"></a>00626       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>      i, j;
<a name="l00627"></a>00627       <span class="keywordflow">for</span> (i = 0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l00628"></a>00628         <span class="keywordflow">if</span> ((idx = <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;<a class="code" href="classSBParameterList.html#a925d2f705ca13c982d0511be8e503f91">idx</a>( (Par=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;at(i)) ))!=-1)
<a name="l00629"></a>00629           *(Idx+i) = idx;
<a name="l00630"></a>00630         <span class="keywordflow">else</span>
<a name="l00631"></a>00631           <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00632"></a>00632                      <span class="stringliteral">&quot;: cannot find the global parameter [&quot;</span> + Par-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>() + 
<a name="l00633"></a>00633                      <span class="stringliteral">&quot;] in the list of all global parameters&quot;</span>);
<a name="l00634"></a>00634       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l00635"></a>00635         {
<a name="l00636"></a>00636           <a class="code" href="classSBEstimator.html#af00c4b661244386bcc34c3c1020c44fd">Y</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(*(Idx+i)));
<a name="l00637"></a>00637           <span class="keywordflow">for</span> (j=i; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)
<a name="l00638"></a>00638             <a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(i, j, <a class="code" href="classSBEstimator.html#a5f73197bfce88b7c02c4536f8ea35f18">PyAll</a>-&gt;<a class="code" href="classSBSymMatrix.html#a2cd7bdf447dddb30e767e457bc64edf8">at</a>(*(Idx+i), *(Idx+j)));
<a name="l00639"></a>00639         };
<a name="l00640"></a>00640            
<a name="l00641"></a>00641       <span class="comment">// solve the parameters:</span>
<a name="l00642"></a>00642       <span class="comment">//     Rx * X = Zx - Rxy*Y</span>
<a name="l00643"></a>00643       <a class="code" href="SbVector_8C.html#ab7f86262fafe0ccc92593a013eb131cb">Solve</a>(*<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>, *<a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a>, *<a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a> - *<a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>**<a class="code" href="classSBEstimator.html#af00c4b661244386bcc34c3c1020c44fd">Y</a>);
<a name="l00644"></a>00644       <a class="code" href="SbVector_8C.html#a134f62483ef7bcd6690bf2462f67635e">RRT</a>(*<a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>, (*RxInv=~*<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>));
<a name="l00645"></a>00645       <span class="keywordflow">if</span> (Ny)
<a name="l00646"></a>00646         <span class="comment">//     Px +      Rx^(-T) * (Rxy * Py * Rxy^T) * Rx^(-T)</span>
<a name="l00647"></a>00647         *<a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a> += <a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(<a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(*<a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a>, *<a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>), *RxInv);
<a name="l00648"></a>00648       <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;<a class="code" href="classSBParameterList.html#a11cff8765706e38199833b830164c7c1">updateSolution</a>(<a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a>, <a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>);
<a name="l00649"></a>00649       
<a name="l00650"></a>00650       <span class="comment">// submit to the SBSolution:</span>
<a name="l00651"></a>00651       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#afe9f15193948c041b27e0a5a896ba4db">submitLocalParameters</a>(<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>, <a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>);
<a name="l00652"></a>00652       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a0f231f2e7cb58976aca36c4dc99bc030">reportLocalParameters</a>();
<a name="l00653"></a>00653       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#a47f7f9c9226ef0428c4af8639e4b6574">setTStart</a>(TofBatch);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 
<a name="l00656"></a>00656       <a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a> = 0;
<a name="l00657"></a>00657       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a9b0ef547a31b176e6fa0129144189f69">NumOfStochs</a>)
<a name="l00658"></a>00658         <a class="code" href="classSBEstimator.html#aafd5e2b7112609651a2b69b34576ea73">solveStochs</a>(wd, <a class="code" href="classSBEstimator.html#a9b0ef547a31b176e6fa0129144189f69">NumOfStochs</a>);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660       <span class="comment">// rm the temporary direcotry:</span>
<a name="l00661"></a>00661       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a54ba92ebd96d2e213b6f6db3270ef980">IsNeedRmTemp</a>)
<a name="l00662"></a>00662         {
<a name="l00663"></a>00663           <span class="keywordflow">if</span> (dir.exists(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(*wd)) &amp;&amp; !dir.rmdir(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(*wd)))
<a name="l00664"></a>00664             <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4a6e3db46e3cb3799c95e1a3c6f5cb1719">SBLog::IO</a> | <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00665"></a>00665                        <span class="stringliteral">&quot;: cannot delete the directory [&quot;</span> + <a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(*wd) + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00666"></a>00666         };
<a name="l00667"></a>00667 
<a name="l00668"></a>00668       <span class="keyword">delete</span>[] Idx;
<a name="l00669"></a>00669       <span class="keywordflow">if</span> (wd)    <span class="keyword">delete</span> wd;
<a name="l00670"></a>00670       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>;     <a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>   = NULL;};
<a name="l00671"></a>00671       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>;     <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>   = NULL;};
<a name="l00672"></a>00672       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>)  {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>;    <a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>  = NULL;};
<a name="l00673"></a>00673       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>;     <a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>   = NULL;};
<a name="l00674"></a>00674       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a>;      <a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a>    = NULL;};
<a name="l00675"></a>00675       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>;     <a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>   = NULL;};
<a name="l00676"></a>00676       <span class="keywordflow">if</span> (RxInv){<span class="keyword">delete</span> RxInv;  RxInv= NULL;};
<a name="l00677"></a>00677       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>;     <a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>   = NULL;};
<a name="l00678"></a>00678       <span class="keywordflow">if</span> (Y)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#af00c4b661244386bcc34c3c1020c44fd">Y</a>;      Y    = NULL;};
<a name="l00679"></a>00679       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a>;     <a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a>   = NULL;};
<a name="l00680"></a>00680     };
<a name="l00681"></a>00681 };
<a name="l00682"></a>00682 
<a name="l00683"></a><a class="code" href="classSBEstimator.html#aafd5e2b7112609651a2b69b34576ea73">00683</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#aafd5e2b7112609651a2b69b34576ea73">SBEstimator::solveStochs</a>(<span class="keyword">const</span> QString* wd, <span class="keywordtype">int</span> Num)
<a name="l00684"></a>00684 {
<a name="l00685"></a>00685   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00686"></a>00686              <span class="stringliteral">&quot;: solving stochastic parameters in the directory [&quot;</span> + <a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(*wd) + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                  i;
<a name="l00689"></a>00689   <span class="keywordtype">int</span>                           *Idx=NULL;
<a name="l00690"></a>00690   <a class="code" href="classSBEstimator_1_1SmoothCarrier.html">SmoothCarrier</a>                 *Carrier;
<a name="l00691"></a>00691   QStack&lt;SmoothCarrier&gt;         StochStack;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693   StochStack.clear();
<a name="l00694"></a>00694   StochStack.setAutoDelete(TRUE);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696   <a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>.setName(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(*wd) + <span class="stringliteral">&quot;stochastics.bin.gz&quot;</span>);
<a name="l00697"></a>00697   <a class="code" href="classSBEstimator.html#ae39f881dc1958ad63377c6e54ec896d0">pipe4Stoch</a> = <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#aae9646a67d46986d776d5fcf5f85084c">fcList</a>()-&gt;<a class="code" href="classSBFCList.html#ac5d0d2479b14509ab42847bfd3ad7bd9">open4In</a>(<a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>.name(), <a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>, <a class="code" href="classSBEstimator.html#a82c2e8d24a7000262ed78aec1eb5d46b">stream4Stoch</a>);
<a name="l00698"></a>00698   <span class="comment">//  if (!file4Stoch.open(IO_ReadOnly))</span>
<a name="l00699"></a>00699   <span class="comment">//    Log-&gt;write(SBLog::ERR, SBLog::ESTIMATOR, ClassName() + </span>
<a name="l00700"></a>00700   <span class="comment">//           &quot;: cannot open the file [&quot; + file4Stoch.name() + &quot;]&quot;);</span>
<a name="l00701"></a>00701   <span class="comment">//  stream4Stoch.setDevice(&amp;file4Stoch);</span>
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;Num; l++)
<a name="l00704"></a>00704     {
<a name="l00705"></a>00705       Carrier = <span class="keyword">new</span> <a class="code" href="classSBEstimator_1_1SmoothCarrier.html">SmoothCarrier</a>;
<a name="l00706"></a>00706       Carrier-&gt;<a class="code" href="classSBEstimator_1_1SmoothCarrier.html#aef0cc28a26c450c41dc866de49b7007f">load</a>(<a class="code" href="classSBEstimator.html#a82c2e8d24a7000262ed78aec1eb5d46b">stream4Stoch</a>);
<a name="l00707"></a>00707       StochStack.push(Carrier);
<a name="l00708"></a>00708     };
<a name="l00709"></a>00709 
<a name="l00710"></a>00710   <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a> = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>;
<a name="l00711"></a>00711   <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>;
<a name="l00712"></a>00712   <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>;
<a name="l00713"></a>00713   <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>;
<a name="l00714"></a>00714   <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a> = <span class="keyword">new</span> <a class="code" href="classSBParameterList.html">SBParameterList</a>;
<a name="l00715"></a>00715   <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;setAutoDelete(TRUE);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717   <a class="code" href="classSBEstimator.html#a82c2e8d24a7000262ed78aec1eb5d46b">stream4Stoch</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a> &gt;&gt; *<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>;
<a name="l00718"></a>00718   <a class="code" href="SbSetup_8C.html#ab22099f310d06d492236a87cc020822b">SetUp</a>-&gt;<a class="code" href="classSBSetUp.html#aae9646a67d46986d776d5fcf5f85084c">fcList</a>()-&gt;<a class="code" href="classSBFCList.html#a5ded2843bcbc8cbf8c5435f84f9a935c">close</a>(<a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>, <a class="code" href="classSBEstimator.html#ae39f881dc1958ad63377c6e54ec896d0">pipe4Stoch</a>, <a class="code" href="classSBEstimator.html#a82c2e8d24a7000262ed78aec1eb5d46b">stream4Stoch</a>);
<a name="l00719"></a>00719   <span class="comment">//  file4Stoch.close();</span>
<a name="l00720"></a>00720   <span class="comment">//  stream4Stoch.unsetDevice();</span>
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   <span class="comment">// rm the temporary file:</span>
<a name="l00723"></a>00723   QDir dir;
<a name="l00724"></a>00724   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a54ba92ebd96d2e213b6f6db3270ef980">IsNeedRmTemp</a>)
<a name="l00725"></a>00725     {
<a name="l00726"></a>00726       <span class="keywordflow">if</span> (dir.exists(<a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>.name()) &amp;&amp; !dir.remove(<a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>.name()))
<a name="l00727"></a>00727         <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4a6e3db46e3cb3799c95e1a3c6f5cb1719">SBLog::IO</a> | <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00728"></a>00728                    <span class="stringliteral">&quot;: cannot delete the file [&quot;</span> + <a class="code" href="classSBEstimator.html#ada4066f8fbe56d69bd910521c3af3843">file4Stoch</a>.name() + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00729"></a>00729     };
<a name="l00730"></a>00730   
<a name="l00731"></a>00731   <a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a> = Ps-&gt;count();
<a name="l00732"></a>00732   <a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>  = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, <span class="stringliteral">&quot;P&quot;</span>);
<a name="l00733"></a>00733   <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a> = <span class="keyword">new</span> <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, <span class="stringliteral">&quot;Pp&quot;</span>);
<a name="l00734"></a>00734   <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a> *RpInv = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, <span class="stringliteral">&quot;Inverse of Rp&quot;</span>);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <span class="comment">// calc filtered estimation (the last in the batch):</span>
<a name="l00737"></a>00737   <span class="comment">// solve the parameters:</span>
<a name="l00738"></a>00738 
<a name="l00739"></a>00739   <span class="comment">//     Rp * P = Zp - Rpx*X - Rpy*Y</span>
<a name="l00740"></a>00740   <a class="code" href="SbVector_8C.html#ab7f86262fafe0ccc92593a013eb131cb">Solve</a>(*<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>, *<a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>, *<a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a> - *<a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>**<a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a> - *<a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>**<a class="code" href="classSBEstimator.html#af00c4b661244386bcc34c3c1020c44fd">Y</a>);
<a name="l00741"></a>00741   
<a name="l00742"></a>00742   <a class="code" href="SbVector_8C.html#a134f62483ef7bcd6690bf2462f67635e">RRT</a>(*<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>, (*RpInv=~*<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>));
<a name="l00743"></a>00743   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>)
<a name="l00744"></a>00744     <span class="comment">//     Pp +      Rp^(-1) * (Rpx * Px * Rpx^T) * Rp^(-T)</span>
<a name="l00745"></a>00745     *<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a> += <a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(<a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(*<a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>, *<a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>), *RpInv);
<a name="l00746"></a>00746   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>)
<a name="l00747"></a>00747     <span class="comment">//     Pp +      Rp^(-1) * (Rpy * Py * Rpy^T) * Rp^(-T)</span>
<a name="l00748"></a>00748     *<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a> += <a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(<a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(*<a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a>, *<a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>), *RpInv);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750   <span class="comment">// and overlay them by `cont&#39;s:</span>
<a name="l00751"></a>00751   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a> &amp;&amp; <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>-&gt;count())
<a name="l00752"></a>00752     {
<a name="l00753"></a>00753       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#af8a7fcdb5927fd7f3e15ceabb6c45049">PAux</a> &amp;&amp; <a class="code" href="classSBEstimator.html#a47cef43d0e89309d544fbdb84e792471">Pp_Aux</a>)
<a name="l00754"></a>00754         {
<a name="l00755"></a>00755           <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;<a class="code" href="classSBParameterList.html#a323bc78dceb35f282e203f7b5ac1f502">clear</a>();
<a name="l00756"></a>00756 
<a name="l00757"></a>00757           <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a> *Rp_sCont = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>;
<a name="l00758"></a>00758           <a class="code" href="classSBMatrix.html">SBMatrix</a>      *Rpp_sCont= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>;
<a name="l00759"></a>00759           <a class="code" href="classSBMatrix.html">SBMatrix</a>      *Rpy_sCont= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>;
<a name="l00760"></a>00760           <a class="code" href="classSBVector.html">SBVector</a>      *Zp_sCont = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>;
<a name="l00761"></a>00761 
<a name="l00762"></a>00762           QFile f(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(*wd) + <span class="stringliteral">&quot;stochastics_aux.bin&quot;</span>);
<a name="l00763"></a>00763           <span class="keywordflow">if</span> (!f.open(IO_ReadOnly))
<a name="l00764"></a>00764             <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: cannot open the file [&quot;</span> + f.name() + 
<a name="l00765"></a>00765                        <span class="stringliteral">&quot;] for reading&quot;</span>);
<a name="l00766"></a>00766           <span class="keywordflow">else</span>
<a name="l00767"></a>00767             {
<a name="l00768"></a>00768               QDataStream data_stream(&amp;f);
<a name="l00769"></a>00769               data_stream &gt;&gt; *<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a> &gt;&gt; *Zp_sCont &gt;&gt; *Rp_sCont &gt;&gt; *Rpp_sCont &gt;&gt; *Rpy_sCont;
<a name="l00770"></a>00770               data_stream.unsetDevice();
<a name="l00771"></a>00771               f.close();
<a name="l00772"></a>00772 
<a name="l00773"></a>00773               <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a54ba92ebd96d2e213b6f6db3270ef980">IsNeedRmTemp</a>)
<a name="l00774"></a>00774                 <span class="keywordflow">if</span> (dir.exists(f.name()) &amp;&amp; !dir.remove(f.name()))
<a name="l00775"></a>00775                   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4a6e3db46e3cb3799c95e1a3c6f5cb1719">SBLog::IO</a> | <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00776"></a>00776                              <span class="stringliteral">&quot;: cannot delete the file [&quot;</span> + f.name() + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00777"></a>00777             };
<a name="l00778"></a>00778 
<a name="l00779"></a>00779           <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;count())
<a name="l00780"></a>00780             {
<a name="l00781"></a>00781               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NumTmp = <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;count();
<a name="l00782"></a>00782               <span class="keywordtype">int</span> *Idx_POld = <span class="keyword">new</span> <span class="keywordtype">int</span>[NumTmp];
<a name="l00783"></a>00783               <span class="keywordtype">int</span> *Idx_PNew = <span class="keyword">new</span> <span class="keywordtype">int</span>[NumTmp];
<a name="l00784"></a>00784 
<a name="l00785"></a>00785               <span class="keywordflow">for</span> (i=0; i&lt;NumTmp; i++)
<a name="l00786"></a>00786                 {
<a name="l00787"></a>00787                   *(Idx_POld+i) = <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>-&gt;<a class="code" href="classSBParameterList.html#a925d2f705ca13c982d0511be8e503f91">idx</a>(<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;at(i));
<a name="l00788"></a>00788                   *(Idx_PNew+i) = Ps-&gt;idx(<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;at(i));
<a name="l00789"></a>00789                 };
<a name="l00790"></a>00790 
<a name="l00791"></a>00791               <a class="code" href="classSBVector.html">SBVector</a>      *P_N = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(NumTmp, <span class="stringliteral">&quot;P_N&quot;</span>);
<a name="l00792"></a>00792               <a class="code" href="classSBVector.html">SBVector</a>      *P_j = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(NumTmp, <span class="stringliteral">&quot;P_j&quot;</span>);
<a name="l00793"></a>00793 
<a name="l00794"></a>00794               <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a> *Rp_jInv = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(NumTmp, <span class="stringliteral">&quot;Inverse of Rp_sCont&quot;</span>);
<a name="l00795"></a>00795               <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>   *Pp_j    = <span class="keyword">new</span> <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>  (NumTmp, <span class="stringliteral">&quot;Pp_j&quot;</span>);
<a name="l00796"></a>00796               <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>   *Pp_N    = <span class="keyword">new</span> <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>  (NumTmp, <span class="stringliteral">&quot;Pp_N&quot;</span>);
<a name="l00797"></a>00797 
<a name="l00798"></a>00798               <span class="keywordflow">for</span> (i=0; i&lt;NumTmp; i++)
<a name="l00799"></a>00799                 {
<a name="l00800"></a>00800                   P_N-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#af8a7fcdb5927fd7f3e15ceabb6c45049">PAux</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(*(Idx_POld+i)));
<a name="l00801"></a>00801                   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=i; j&lt;NumTmp; j++)
<a name="l00802"></a>00802                     Pp_N-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(i,j,  <a class="code" href="classSBEstimator.html#a47cef43d0e89309d544fbdb84e792471">Pp_Aux</a>-&gt;<a class="code" href="classSBSymMatrix.html#a2cd7bdf447dddb30e767e457bc64edf8">at</a>(*(Idx_POld+i), *(Idx_POld+j)));
<a name="l00803"></a>00803                 };
<a name="l00804"></a>00804 
<a name="l00805"></a>00805               <span class="comment">// solve the parameters:</span>
<a name="l00806"></a>00806               <span class="comment">//</span>
<a name="l00807"></a>00807               <span class="comment">//         Rp_ *  P     =  Zp_s     -  Rpp_s*PPrev    -    Rpy_s*Y</span>
<a name="l00808"></a>00808               <a class="code" href="SbVector_8C.html#ab7f86262fafe0ccc92593a013eb131cb">Solve</a>(*Rp_sCont, *P_j,    *Zp_sCont - *Rpp_sCont**P_N - *Rpy_sCont**<a class="code" href="classSBEstimator.html#a8a7c26258af685970c8772690d1d67d5">YAll</a>);
<a name="l00809"></a>00809               
<a name="l00810"></a>00810 
<a name="l00811"></a>00811               <span class="comment">// here to add a calculations for covariance matrix:</span>
<a name="l00812"></a>00812               <span class="comment">//  Pp_j = (Rp*)^(-1) * (Rp*)^(-T)</span>
<a name="l00813"></a>00813               <a class="code" href="SbVector_8C.html#a134f62483ef7bcd6690bf2462f67635e">RRT</a>(*Pp_j, (*Rp_jInv=~*Rp_sCont));
<a name="l00814"></a>00814               <span class="comment">//     Pp +      (Rp*)^(-1) * ((Rpp*) * Pp_prev * (Rpp*)^T) * (Rp*)^(-T)</span>
<a name="l00815"></a>00815               *Pp_j += <a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(<a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(*Pp_N, *Rpp_sCont), *Rp_jInv);
<a name="l00816"></a>00816 
<a name="l00817"></a>00817               <span class="comment">//              if (Ny)</span>
<a name="l00818"></a>00818               <span class="comment">//                //     Pp +      (Rp*)^(-1) * ((Rpy*) * Py * (Rpy*)^T) * (Rp*)^(-T)</span>
<a name="l00819"></a>00819               <span class="comment">//                *Pp += QuadraticForm(QuadraticForm(*Py, *Rpy_s), *RpInv);</span>
<a name="l00820"></a>00820               
<a name="l00821"></a>00821               <span class="keywordflow">for</span> (i=0; i&lt;NumTmp; i++)
<a name="l00822"></a>00822                 {
<a name="l00823"></a>00823                   <a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(*(Idx_PNew+i), P_j-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i));
<a name="l00824"></a>00824                   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=i; j&lt;NumTmp; j++)
<a name="l00825"></a>00825                     <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(*(Idx_PNew+i), *(Idx_PNew+j), Pp_j-&gt;<a class="code" href="classSBSymMatrix.html#a2cd7bdf447dddb30e767e457bc64edf8">at</a>(i,j));
<a name="l00826"></a>00826                 };
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 
<a name="l00829"></a>00829               <span class="keyword">delete</span> Pp_N;
<a name="l00830"></a>00830               <span class="keyword">delete</span> Pp_j;
<a name="l00831"></a>00831               <span class="keyword">delete</span> Rp_jInv;
<a name="l00832"></a>00832               <span class="keyword">delete</span> P_j;
<a name="l00833"></a>00833               <span class="keyword">delete</span> P_N;
<a name="l00834"></a>00834               <span class="keyword">delete</span>[] Idx_POld;
<a name="l00835"></a>00835               <span class="keyword">delete</span>[] Idx_PNew;
<a name="l00836"></a>00836             };
<a name="l00837"></a>00837 
<a name="l00838"></a>00838           <span class="keyword">delete</span> Rp_sCont;
<a name="l00839"></a>00839           <span class="keyword">delete</span> Rpp_sCont;
<a name="l00840"></a>00840           <span class="keyword">delete</span> Rpy_sCont;
<a name="l00841"></a>00841           <span class="keyword">delete</span> Zp_sCont;
<a name="l00842"></a>00842         }
<a name="l00843"></a>00843       <span class="keywordflow">else</span> <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l00844"></a>00844                       <span class="stringliteral">&quot;: wrong order of continiuous Stochastic parameters&quot;</span>);
<a name="l00845"></a>00845     };
<a name="l00846"></a>00846 
<a name="l00847"></a>00847   <span class="comment">// make solution and submit it to the SBSolution:</span>
<a name="l00848"></a>00848   Ps-&gt;updateSolution(<a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>, <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>);
<a name="l00849"></a>00849   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a99084c13292a8041494266b250f34f1f">submitStochasticParameters</a>(Ps, <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   <span class="comment">// check for `cont&#39; flag:</span>
<a name="l00852"></a>00852   <a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a> = 0;
<a name="l00853"></a>00853   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; i++)
<a name="l00854"></a>00854     <span class="keywordflow">if</span> (Ps-&gt;at(i)-&gt;isAttr(<a class="code" href="classSBDerivation.html#a19607f8eddf33f7fbcc3fdaf9cd52e9bac4aff1d14cf20bbe45f253bb979ba35e" title="the parameter&#39;s info have to be propagated in future">SBDerivation::IsPropagated</a>))
<a name="l00855"></a>00855       <a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a>++;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a>)
<a name="l00858"></a>00858     {
<a name="l00859"></a>00859       <span class="keywordflow">if</span> (!<a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>)
<a name="l00860"></a>00860         {
<a name="l00861"></a>00861           <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a> = <span class="keyword">new</span> <a class="code" href="classSBParameterList.html">SBParameterList</a>;
<a name="l00862"></a>00862           <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>-&gt;setAutoDelete(TRUE);
<a name="l00863"></a>00863         }
<a name="l00864"></a>00864       <span class="keywordflow">else</span> 
<a name="l00865"></a>00865         <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>-&gt;<a class="code" href="classSBParameterList.html#a323bc78dceb35f282e203f7b5ac1f502">clear</a>();
<a name="l00866"></a>00866 
<a name="l00867"></a>00867       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; i++)
<a name="l00868"></a>00868         <a class="code" href="classSBEstimator.html#a7d48458114d89c77a0bc3143c1288fb8">PsAux</a>-&gt;<a class="code" href="classSBParameterList.html#ada2b1da7bfbacc2f6bc7e7234aace0bc">append</a>(<span class="keyword">new</span> <a class="code" href="classSBParameter.html">SBParameter</a>(*Ps-&gt;at(i)));
<a name="l00869"></a>00869       
<a name="l00870"></a>00870       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#af8a7fcdb5927fd7f3e15ceabb6c45049">PAux</a>)
<a name="l00871"></a>00871         <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#af8a7fcdb5927fd7f3e15ceabb6c45049">PAux</a>;
<a name="l00872"></a>00872       <a class="code" href="classSBEstimator.html#af8a7fcdb5927fd7f3e15ceabb6c45049">PAux</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(Np, <span class="stringliteral">&quot;PAux&quot;</span>);
<a name="l00873"></a>00873       
<a name="l00874"></a>00874       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a47cef43d0e89309d544fbdb84e792471">Pp_Aux</a>)
<a name="l00875"></a>00875         <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a47cef43d0e89309d544fbdb84e792471">Pp_Aux</a>;
<a name="l00876"></a>00876       <a class="code" href="classSBEstimator.html#a47cef43d0e89309d544fbdb84e792471">Pp_Aux</a> = <span class="keyword">new</span> <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>(Np, <span class="stringliteral">&quot;Pp_Aux&quot;</span>);
<a name="l00877"></a>00877     };
<a name="l00878"></a>00878   <span class="comment">//........</span>
<a name="l00879"></a>00879 
<a name="l00880"></a>00880 
<a name="l00881"></a>00881   <span class="keywordflow">if</span> (Ps) {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>; Ps = NULL;};
<a name="l00882"></a>00882   <a class="code" href="classSBVector.html">SBVector</a>      *Pprev = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(Np, <span class="stringliteral">&quot;P_(n-1)&quot;</span>);
<a name="l00883"></a>00883   *Pprev = *<a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>;
<a name="l00884"></a>00884 
<a name="l00885"></a>00885   <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>   *Pp_prev = <span class="keyword">new</span> <a class="code" href="classSBSymMatrix.html">SBSymMatrix</a>(Np, <span class="stringliteral">&quot;Pp_(prev)&quot;</span>);
<a name="l00886"></a>00886   *Pp_prev = *<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>;
<a name="l00887"></a>00887 
<a name="l00888"></a>00888   <span class="keywordflow">while</span> (!StochStack.isEmpty())
<a name="l00889"></a>00889     {
<a name="l00890"></a>00890       Carrier = StochStack.pop();
<a name="l00891"></a>00891       Ps    = Carrier-&gt;<a class="code" href="classSBEstimator_1_1SmoothCarrier.html#a53613dd102ea1aff07b1ad4785c6fa8d">Ps</a>;
<a name="l00892"></a>00892       <a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a>  = Carrier-&gt;<a class="code" href="classSBEstimator_1_1SmoothCarrier.html#acf4f1ee7ca37cf0fc793891b79d9c981">Rp_s</a>;
<a name="l00893"></a>00893       <a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a> = Carrier-&gt;<a class="code" href="classSBEstimator_1_1SmoothCarrier.html#a08474e83da2a862773a953c2a22d5d41">Rpp_s</a>;
<a name="l00894"></a>00894       <a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a> = Carrier-&gt;<a class="code" href="classSBEstimator_1_1SmoothCarrier.html#a6ce07a0ba965469c57e8d3b275b50a1b">Rpx_s</a>;
<a name="l00895"></a>00895       <a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a> = Carrier-&gt;<a class="code" href="classSBEstimator_1_1SmoothCarrier.html#aa92e04122e11f56408c0c66144b3507f">Rpy_s</a>;
<a name="l00896"></a>00896       <a class="code" href="classSBEstimator.html#ab292cd23df263897e946d361214fd7d2">Zp_s</a>  = Carrier-&gt;<a class="code" href="classSBEstimator_1_1SmoothCarrier.html#a2b05db568bcc7487889ef72754dc30af">Zp_s</a>;
<a name="l00897"></a>00897 
<a name="l00898"></a>00898       <span class="comment">// solve the parameters:</span>
<a name="l00899"></a>00899       <span class="comment">//</span>
<a name="l00900"></a>00900       <span class="comment">//     Rp_s * P = Zp_s - Rpp_s*PPrev - Rpx_s*X - Rpy_s*Y</span>
<a name="l00901"></a>00901       <a class="code" href="SbVector_8C.html#ab7f86262fafe0ccc92593a013eb131cb">Solve</a>(*<a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a>, *<a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>, *<a class="code" href="classSBEstimator.html#ab292cd23df263897e946d361214fd7d2">Zp_s</a> - *<a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a>**Pprev - *<a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a>**<a class="code" href="classSBEstimator.html#a17303608242dddd699778a6a9979352c">X</a> - *<a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a>**Y);
<a name="l00902"></a>00902       
<a name="l00903"></a>00903       <a class="code" href="classSBMatrix.html">SBMatrix</a> QQQ = <a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a249b247cf4bfc9193117ff9f25b4c2fb">T</a>();
<a name="l00904"></a>00904       <span class="comment">// here to add a calculations for covariance matrix:</span>
<a name="l00905"></a>00905       <span class="comment">//  Pp = (Rp*)^(-1) * (Rp*)^(-T)</span>
<a name="l00906"></a>00906       <a class="code" href="SbVector_8C.html#a134f62483ef7bcd6690bf2462f67635e">RRT</a>(*<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>, (*RpInv=~*<a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a>));
<a name="l00907"></a>00907       <span class="comment">//     Pp +      (Rp*)^(-1) * ((Rpp*) * Pp_prev * (Rpp*)^T) * (Rp*)^(-T)</span>
<a name="l00908"></a>00908       *<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a> += <a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(<a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(*Pp_prev, *<a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a>), *RpInv);
<a name="l00909"></a>00909       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>)
<a name="l00910"></a>00910         <span class="comment">//     Pp +      (Rp*)^(-1) * ((Rpx*) * Px * (Rpx*)^T) * (Rp*)^(-T)</span>
<a name="l00911"></a>00911         *<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a> += <a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(<a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(*<a class="code" href="classSBEstimator.html#ac389d2e0f630cc096672c5a6a7b53edc">Px</a>, *<a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a>), *RpInv);
<a name="l00912"></a>00912       <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>)
<a name="l00913"></a>00913         <span class="comment">//     Pp +      (Rp*)^(-1) * ((Rpy*) * Py * (Rpy*)^T) * (Rp*)^(-T)</span>
<a name="l00914"></a>00914         *<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a> += <a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(<a class="code" href="SbVector_8C.html#aadc92bc6520fd94b141d40f3938b762d">QuadraticForm</a>(*<a class="code" href="classSBEstimator.html#ab24f7d0ef35f9f03c8da9443b004049a">Py</a>, *<a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a>), *RpInv);
<a name="l00915"></a>00915       
<a name="l00916"></a>00916       Ps-&gt;updateSolution(<a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>, <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>);
<a name="l00917"></a>00917             
<a name="l00918"></a>00918       <span class="comment">// submit to the SBSolution:</span>
<a name="l00919"></a>00919       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a99084c13292a8041494266b250f34f1f">submitStochasticParameters</a>(Ps, <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>);
<a name="l00920"></a>00920       
<a name="l00921"></a>00921       *Pprev = *<a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>;
<a name="l00922"></a>00922       *Pp_prev = *<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>;
<a name="l00923"></a>00923       <span class="keywordflow">if</span> (Carrier) <span class="keyword">delete</span> Carrier;
<a name="l00924"></a>00924     };
<a name="l00925"></a>00925 
<a name="l00926"></a>00926 
<a name="l00927"></a>00927   <span class="comment">// keep last calculated `cont&#39; stochs:</span>
<a name="l00928"></a>00928   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a8d833627cf631d68f7f3f88f15497060">NStochsCont</a>)
<a name="l00929"></a>00929     {
<a name="l00930"></a>00930       *<a class="code" href="classSBEstimator.html#af8a7fcdb5927fd7f3e15ceabb6c45049">PAux</a>     = *<a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>;
<a name="l00931"></a>00931       *<a class="code" href="classSBEstimator.html#a47cef43d0e89309d544fbdb84e792471">Pp_Aux</a>   = *<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>;
<a name="l00932"></a>00932     };
<a name="l00933"></a>00933   <span class="comment">//..............</span>
<a name="l00934"></a>00934 
<a name="l00935"></a>00935   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#ab266f965ee19ed696d78453d603809f9">saveStochasticParameters</a>(); <span class="comment">// special case</span>
<a name="l00936"></a>00936   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a7cdbe1452e20368ff7fad73cdb6dc864">reportStochasticParameters</a>();
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <span class="keywordflow">if</span> (Idx)  {<span class="keyword">delete</span>[] Idx; Idx  = NULL;};
<a name="l00939"></a>00939   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>;    <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>   = NULL;};
<a name="l00940"></a>00940   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>)  {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>;   <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>  = NULL;};
<a name="l00941"></a>00941   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>)  {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>;   <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>  = NULL;};
<a name="l00942"></a>00942   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>;    <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>   = NULL;};
<a name="l00943"></a>00943   <span class="comment">//  if (Ps)   {delete Ps;    Ps   = NULL;};</span>
<a name="l00944"></a>00944   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>;     <a class="code" href="classSBEstimator.html#a52b2213de5c66f725f8ac8a272633a1e">P</a>    = NULL;};
<a name="l00945"></a>00945   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>)   {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>;    <a class="code" href="classSBEstimator.html#a59b34c49b1f1b1b016f9b532da7e5973">Pp</a>   = NULL;};
<a name="l00946"></a>00946   <span class="keywordflow">if</span> (Pprev){<span class="keyword">delete</span> Pprev; Pprev= NULL;};
<a name="l00947"></a>00947   <span class="keywordflow">if</span> (Pp_prev){<span class="keyword">delete</span> Pp_prev; Pp_prev= NULL;};
<a name="l00948"></a>00948   <span class="keywordflow">if</span> (RpInv){<span class="keyword">delete</span> RpInv; RpInv= NULL;};
<a name="l00949"></a>00949   StochStack.<a class="code" href="classSBUpperMatrix.html#a55247f05a6bbfa554044bbbdf193a7d5">clear</a>();
<a name="l00950"></a>00950 };
<a name="l00951"></a>00951 
<a name="l00952"></a><a class="code" href="classSBEstimator.html#a4e63166bfa8073aea0116c1e8884b04d">00952</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a4e63166bfa8073aea0116c1e8884b04d">SBEstimator::processObs</a>(<span class="keyword">const</span> <a class="code" href="classSBMJD.html">SBMJD</a>&amp; T, <span class="keyword">const</span> <a class="code" href="classSBMJD.html">SBMJD</a>&amp; Tnext, <span class="keyword">const</span> <a class="code" href="classSBVector.html">SBVector</a>&amp; O_C, <span class="keyword">const</span> <a class="code" href="classSBVector.html">SBVector</a>&amp; Sigma)
<a name="l00953"></a>00953 {
<a name="l00954"></a>00954   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i;
<a name="l00955"></a>00955   <a class="code" href="classSBDerivation.html">SBDerivation</a>  *d=NULL;
<a name="l00956"></a>00956   <span class="keywordtype">double</span>        weight=0.0;
<a name="l00957"></a>00957   
<a name="l00958"></a>00958   <span class="comment">// global parameters:</span>
<a name="l00959"></a>00959   <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; d=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;next(), i++)
<a name="l00960"></a>00960     {
<a name="l00961"></a>00961       <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma.<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(0));
<a name="l00962"></a>00962       d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l00963"></a>00963     };
<a name="l00964"></a>00964 
<a name="l00965"></a>00965   <span class="comment">// local parameters:</span>
<a name="l00966"></a>00966   <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; d=<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;next(), i++)
<a name="l00967"></a>00967     {
<a name="l00968"></a>00968       <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma.<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(0));
<a name="l00969"></a>00969       d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l00970"></a>00970     };
<a name="l00971"></a>00971 
<a name="l00972"></a>00972   <span class="comment">// stochastic parameters:</span>
<a name="l00973"></a>00973   <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; d=<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;next(), i++)
<a name="l00974"></a>00974     {
<a name="l00975"></a>00975       <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma.<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(0));
<a name="l00976"></a>00976       d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l00977"></a>00977     };
<a name="l00978"></a>00978 
<a name="l00979"></a>00979   <span class="comment">// vector Z:</span>
<a name="l00980"></a>00980   <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, O_C.<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(0)/Sigma.<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(0));
<a name="l00981"></a>00981   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>++;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 
<a name="l00984"></a>00984   weight= 1.0/Sigma.<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(0);
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#a4f6754c789a0d29782427ae7ecc2490d">addWRMS</a>(O_C.<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(0), weight);
<a name="l00987"></a>00987 
<a name="l00988"></a>00988   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>())
<a name="l00989"></a>00989     <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#a4f6754c789a0d29782427ae7ecc2490d">addWRMS</a>(O_C.<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(0), weight);
<a name="l00990"></a>00990   
<a name="l00991"></a>00991   <span class="keywordflow">if</span> (Np &amp;&amp; T&lt;Tnext)
<a name="l00992"></a>00992     {
<a name="l00993"></a>00993       <a class="code" href="classSBEstimator.html#a556c1beb24a2418cd39be4d90411d397">dataUpdate</a>();
<a name="l00994"></a>00994       <a class="code" href="classSBEstimator.html#a26a0a204cea8d01934c6c7877550405e">propagateStochasticPars</a>(T, Tnext-T);
<a name="l00995"></a>00995       <a class="code" href="classSBEstimator.html#aa4fbc148f5ce1fdc39885ea68e080241">save4Smoothing</a>();
<a name="l00996"></a>00996       <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;<a class="code" href="classSBParameterList.html#a0b283cf08d72491ad2650db71522058a">clearPValues</a>();
<a name="l00997"></a>00997     };
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   <a class="code" href="classSBEstimator.html#abf4ac4a0c99b7788c04142f78646e2ac">TLastProcessed</a> = T;
<a name="l01000"></a>01000 };
<a name="l01001"></a>01001 
<a name="l01002"></a><a class="code" href="classSBEstimator.html#acd7a34db7afde784bf3d258f6cdec833">01002</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#acd7a34db7afde784bf3d258f6cdec833">SBEstimator::processConstr</a>(<span class="keywordtype">double</span> O_C, <span class="keywordtype">double</span> Sigma)
<a name="l01003"></a>01003 {
<a name="l01004"></a>01004   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i;
<a name="l01005"></a>01005   <a class="code" href="classSBDerivation.html">SBDerivation</a>  *d=NULL;
<a name="l01006"></a>01006   
<a name="l01007"></a>01007   <span class="comment">// global parameters (it goes to `all&#39; list):</span>
<a name="l01008"></a>01008   <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; d=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;next(), i++)
<a name="l01009"></a>01009     {
<a name="l01010"></a>01010       <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma);
<a name="l01011"></a>01011       d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l01012"></a>01012     };
<a name="l01013"></a>01013 
<a name="l01014"></a>01014   <span class="comment">// local parameters:</span>
<a name="l01015"></a>01015   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>)
<a name="l01016"></a>01016     <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; d=<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;next(), i++)
<a name="l01017"></a>01017       {
<a name="l01018"></a>01018         <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma);
<a name="l01019"></a>01019         d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l01020"></a>01020       };
<a name="l01021"></a>01021   
<a name="l01022"></a>01022   <span class="comment">// stochastic parameters:</span>
<a name="l01023"></a>01023   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>)
<a name="l01024"></a>01024     <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; d=<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;next(), i++)
<a name="l01025"></a>01025       {
<a name="l01026"></a>01026         <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma);
<a name="l01027"></a>01027         d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l01028"></a>01028       };
<a name="l01029"></a>01029   
<a name="l01030"></a>01030   <span class="comment">// vector Z:</span>
<a name="l01031"></a>01031   <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, O_C/Sigma);
<a name="l01032"></a>01032   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>++;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034   <span class="comment">//?  Solution-&gt;statGeneral()-&gt;addWRMS(O_C, 1.0/Sigma);</span>
<a name="l01035"></a>01035   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#a46cbf9cd8e327dfb0de30debce52d5b8">addNumConstr</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>);
<a name="l01036"></a>01036 
<a name="l01037"></a>01037   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>())
<a name="l01038"></a>01038     {
<a name="l01039"></a>01039       <span class="comment">//?      Solution-&gt;stat4CurrentBatch()-&gt;addWRMS(O_C, 1.0/Sigma);</span>
<a name="l01040"></a>01040       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#a46cbf9cd8e327dfb0de30debce52d5b8">addNumConstr</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>);
<a name="l01041"></a>01041     };
<a name="l01042"></a>01042   <a class="code" href="classSBEstimator.html#a556c1beb24a2418cd39be4d90411d397">dataUpdate</a>();
<a name="l01043"></a>01043 };
<a name="l01044"></a>01044 
<a name="l01045"></a><a class="code" href="classSBEstimator.html#a9fbd787bcd4c13f8d34139656fa6fa3d">01045</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a9fbd787bcd4c13f8d34139656fa6fa3d">SBEstimator::processGlobalConstr</a>(<span class="keywordtype">double</span> O_C, <span class="keywordtype">double</span> Sigma)
<a name="l01046"></a>01046 {
<a name="l01047"></a>01047   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i;
<a name="l01048"></a>01048   <a class="code" href="classSBDerivation.html">SBDerivation</a>  *d=NULL;
<a name="l01049"></a>01049   
<a name="l01050"></a>01050   <span class="comment">// global parameters (it goes to `all&#39; list):</span>
<a name="l01051"></a>01051   <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; d=<a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;next(), i++)
<a name="l01052"></a>01052     {
<a name="l01053"></a>01053       <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma);
<a name="l01054"></a>01054       d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l01055"></a>01055     };
<a name="l01056"></a>01056 
<a name="l01057"></a>01057   <span class="comment">// local parameters:</span>
<a name="l01058"></a>01058   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>)
<a name="l01059"></a>01059     <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; d=<a class="code" href="classSBEstimator.html#a13e93a4b0851aea8d3d9a74e1f10626b" title="list of local parameters;">Xs</a>-&gt;next(), i++)
<a name="l01060"></a>01060       {
<a name="l01061"></a>01061         <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma);
<a name="l01062"></a>01062         d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l01063"></a>01063       };
<a name="l01064"></a>01064   
<a name="l01065"></a>01065   <span class="comment">// stochastic parameters:</span>
<a name="l01066"></a>01066   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>)
<a name="l01067"></a>01067     <span class="keywordflow">for</span> (i=0, d=<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;first(); i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; d=<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;next(), i++)
<a name="l01068"></a>01068       {
<a name="l01069"></a>01069         <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>,i,  d-&gt;<a class="code" href="classSBDerivation.html#a7a8f01ca1d13a9aa8167cc97a61219bb">d</a>()/Sigma);
<a name="l01070"></a>01070         d-&gt;<a class="code" href="classSBDerivation.html#a96b0d4f4944b5ec29ed6f24d9d745bb2">zero</a>();
<a name="l01071"></a>01071       };
<a name="l01072"></a>01072   
<a name="l01073"></a>01073   <span class="comment">// vector Z:</span>
<a name="l01074"></a>01074   <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, O_C/Sigma);
<a name="l01075"></a>01075   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>++;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   <span class="comment">//?  Solution-&gt;statGeneral()-&gt;addWRMS(O_C, 1.0/Sigma);</span>
<a name="l01078"></a>01078   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#a46cbf9cd8e327dfb0de30debce52d5b8">addNumConstr</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>);
<a name="l01079"></a>01079 
<a name="l01080"></a>01080   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>())
<a name="l01081"></a>01081     {
<a name="l01082"></a>01082       <span class="comment">//?      Solution-&gt;stat4CurrentBatch()-&gt;addWRMS(O_C, 1.0/Sigma);</span>
<a name="l01083"></a>01083       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#a46cbf9cd8e327dfb0de30debce52d5b8">addNumConstr</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>);
<a name="l01084"></a>01084     };
<a name="l01085"></a>01085   <a class="code" href="classSBEstimator.html#a6d1dedabe7b3e921825b59e370a9c3cb">dataUpdateGlobalConstr</a>();
<a name="l01086"></a>01086 };
<a name="l01087"></a>01087 
<a name="l01088"></a><a class="code" href="classSBEstimator.html#ad4697c7ca488eca36cef43fb38d175e7">01088</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#ad4697c7ca488eca36cef43fb38d175e7">SBEstimator::prepare4GlobConstr</a>(<span class="keywordtype">int</span> Nz_) <span class="comment">// in need for global pars only</span>
<a name="l01089"></a>01089 {
<a name="l01090"></a>01090   <span class="comment">// data:</span>
<a name="l01091"></a>01091   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a> = Nz_ + 8;
<a name="l01092"></a>01092   <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>   = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, <span class="stringliteral">&quot;Z&quot;</span>);
<a name="l01093"></a>01093   <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>  = <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>, <a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;Ay&quot;</span>);
<a name="l01094"></a>01094   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>   = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a> + 1, <span class="stringliteral">&quot;U&quot;</span>);
<a name="l01095"></a>01095   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>  = 0; <span class="comment">// from here Nz is a count of observations</span>
<a name="l01096"></a>01096 
<a name="l01097"></a>01097   <a class="code" href="classSBEstimator.html#a9b0ef547a31b176e6fa0129144189f69">NumOfStochs</a> = 0;
<a name="l01098"></a>01098 };
<a name="l01099"></a>01099 
<a name="l01100"></a><a class="code" href="classSBEstimator.html#ae110abf15ee32c8f1f891155700ded07">01100</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#ae110abf15ee32c8f1f891155700ded07">SBEstimator::finisGlobConstr</a>()
<a name="l01101"></a>01101 {
<a name="l01102"></a>01102   <span class="comment">// data:</span>
<a name="l01103"></a>01103   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>)     {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>;     <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>    = NULL;};
<a name="l01104"></a>01104   <span class="comment">//  if (Ap)    {delete Ap;    Ap   = NULL;};</span>
<a name="l01105"></a>01105   <span class="comment">//  if (Ax)    {delete Ax;    Ax   = NULL;};</span>
<a name="l01106"></a>01106   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>)    {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>;    <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>   = NULL;};
<a name="l01107"></a>01107   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>)     {<span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>;     <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>    = NULL;};
<a name="l01108"></a>01108   <a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>  = 0;
<a name="l01109"></a>01109 };
<a name="l01110"></a>01110 
<a name="l01111"></a><a class="code" href="classSBEstimator.html#a26a0a204cea8d01934c6c7877550405e">01111</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a26a0a204cea8d01934c6c7877550405e">SBEstimator::propagateStochasticPars</a>(<span class="keyword">const</span> <a class="code" href="classSBMJD.html">SBMJD</a>&amp; <span class="comment">/*T*/</span>, <span class="keywordtype">double</span> dT)
<a name="l01112"></a>01112 {
<a name="l01113"></a>01113   <span class="comment">// propagate the stochastic parameters from an epoch &quot;T&quot; to a new one &quot;T+dT&quot;:</span>
<a name="l01114"></a>01114   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i,j,l;
<a name="l01115"></a>01115   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  n=2*<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, m=2*<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>+<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>+<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>;
<a name="l01116"></a>01116   <span class="keywordtype">double</span>        s,g;
<a name="l01117"></a>01117   
<a name="l01118"></a>01118   <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#af90d688707e185939cc758ab71cbdd82">clear</a>();
<a name="l01119"></a>01119   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a363629d3609484eff973967c05f49269">clear</a>();
<a name="l01120"></a>01120 
<a name="l01121"></a>01121   <span class="comment">// fill the matrix SR:</span>
<a name="l01122"></a>01122   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; i++)
<a name="l01123"></a>01123     {
<a name="l01124"></a>01124       <a class="code" href="classSBParameter.html">SBParameter</a>      *p  = <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;at( i);
<a name="l01125"></a>01125       <span class="keywordtype">double</span>            mm = p -&gt;<a class="code" href="classSBParameter.html#ad5f9a793710e750252144138b6e24d6f">m</a> (dT);
<a name="l01126"></a>01126       <span class="keywordtype">double</span>            rwn= p -&gt;<a class="code" href="classSBParameter.html#a619f8027c57d61e167d5a94e586fb030">rw</a>(dT);
<a name="l01127"></a>01127 
<a name="l01128"></a>01128       <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i,       i,   -mm*rwn);
<a name="l01129"></a>01129       <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i,    Np+i,       rwn);
<a name="l01130"></a>01130 
<a name="l01131"></a>01131       <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(Np+i,    m, <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i));
<a name="l01132"></a>01132       
<a name="l01133"></a>01133       <span class="keywordflow">for</span> (j=i; j&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; j++) <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(Np+i,      j,  <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a> -&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(i, j));
<a name="l01134"></a>01134       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; j++) <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(Np+i, n   +j,  <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i, j));
<a name="l01135"></a>01135       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++) <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(Np+i, n+Nx+j,  <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i, j));
<a name="l01136"></a>01136     };
<a name="l01137"></a>01137 
<a name="l01138"></a>01138   <span class="comment">// make a Householder transformation</span>
<a name="l01139"></a>01139   <span class="comment">// this should be optimized...</span>
<a name="l01140"></a>01140   <span class="keywordflow">for</span> (l=0; l&lt;n; l++)
<a name="l01141"></a>01141     {
<a name="l01142"></a>01142       <span class="keywordflow">for</span> (i=l, s=0.0; i&lt;n; i++) s+=<a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*<a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01143"></a>01143       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01144"></a>01144         {
<a name="l01145"></a>01145           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,l))*sqrt(s);
<a name="l01146"></a>01146           <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(l, <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,l) - s);                           <span class="comment">// U_l</span>
<a name="l01147"></a>01147           <span class="keywordflow">for</span> (i=l+1; i&lt;n; i++) <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));         <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01148"></a>01148           <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(l,l, s);
<a name="l01149"></a>01149           s = 1.0/(s*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l));                                 <span class="comment">// betta</span>
<a name="l01150"></a>01150           <span class="keywordflow">for</span> (j=l+1; j&lt;m+1; j++)                               <span class="comment">// |-------------------------</span>
<a name="l01151"></a>01151             {                                                   <span class="comment">// |</span>
<a name="l01152"></a>01152               <span class="keywordflow">for</span> (i=l,g=0.0; i&lt;n; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);<span class="comment">// |</span>
<a name="l01153"></a>01153               <span class="keywordflow">for</span> (i=l; i&lt;n; i++) (*<a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);     <span class="comment">// |</span>
<a name="l01154"></a>01154             };                                                  <span class="comment">// |_________________________</span>
<a name="l01155"></a>01155         };
<a name="l01156"></a>01156     };
<a name="l01157"></a>01157 
<a name="l01158"></a>01158   <span class="comment">// fill the matrices for smoothing and filtering:</span>
<a name="l01159"></a>01159   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; i++)
<a name="l01160"></a>01160     {
<a name="l01161"></a>01161       <span class="keywordflow">for</span> (j=i; j&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; j++)
<a name="l01162"></a>01162         {
<a name="l01163"></a>01163           <a class="code" href="classSBEstimator.html#ac8c37aa07a3c6b412c9aef7504a6b97e">Rp_s</a> -&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(i, j,      <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(   i,     j));
<a name="l01164"></a>01164           <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>   -&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(i, j,      <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(Np+i,  Np+j));
<a name="l01165"></a>01165         };
<a name="l01166"></a>01166 
<a name="l01167"></a>01167       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; j++)
<a name="l01168"></a>01168         <a class="code" href="classSBEstimator.html#a8eeb59119629b0496d20d08a10f7a2bd">Rpp_s</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, j,        <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i, Np  +j));
<a name="l01169"></a>01169       
<a name="l01170"></a>01170       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; j++)
<a name="l01171"></a>01171         {
<a name="l01172"></a>01172           <a class="code" href="classSBEstimator.html#a655a96d045154d98f777c6d321052050">Rpx_s</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, j,      <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(   i, n+j));
<a name="l01173"></a>01173           <a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>  -&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, j,      <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(Np+i, n+j));
<a name="l01174"></a>01174         };
<a name="l01175"></a>01175       
<a name="l01176"></a>01176       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)
<a name="l01177"></a>01177         {
<a name="l01178"></a>01178           <a class="code" href="classSBEstimator.html#a886e8504080ac63fb3feb1a14ecbe054">Rpy_s</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, j,      <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(   i, n+Nx+j));
<a name="l01179"></a>01179           <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>  -&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, j,      <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(Np+i, n+Nx+j));
<a name="l01180"></a>01180         };
<a name="l01181"></a>01181 
<a name="l01182"></a>01182       <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>  -&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(Np+i, m));
<a name="l01183"></a>01183       <a class="code" href="classSBEstimator.html#ab292cd23df263897e946d361214fd7d2">Zp_s</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#ad54116e5c7eeea5ad6a2d688a1b4507a">SR</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(   i, m));
<a name="l01184"></a>01184     };
<a name="l01185"></a>01185 };
<a name="l01186"></a>01186 
<a name="l01187"></a><a class="code" href="classSBEstimator.html#a556c1beb24a2418cd39be4d90411d397">01187</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a556c1beb24a2418cd39be4d90411d397">SBEstimator::dataUpdate</a>()
<a name="l01188"></a>01188 {
<a name="l01189"></a>01189   <span class="comment">// make a Householder transformation</span>
<a name="l01190"></a>01190   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i,j,l;
<a name="l01191"></a>01191   <span class="keywordtype">double</span>        s,ul,g;
<a name="l01192"></a>01192   
<a name="l01193"></a>01193   
<a name="l01194"></a>01194   <span class="comment">// Pass one: dealing with the &quot;p&quot;:</span>
<a name="l01195"></a>01195   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a363629d3609484eff973967c05f49269">clear</a>();                                                   <span class="comment">// U-vector, + ul -- the first elementh of U</span>
<a name="l01196"></a>01196   <span class="keywordflow">for</span> (l=0; l&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; l++)
<a name="l01197"></a>01197     {
<a name="l01198"></a>01198       s = <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l)*<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l);
<a name="l01199"></a>01199       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) s+=<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01200"></a>01200       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01201"></a>01201         {
<a name="l01202"></a>01202           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l))*sqrt(s);
<a name="l01203"></a>01203           ul = <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l) - s;                                 <span class="comment">// U_l</span>
<a name="l01204"></a>01204           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));          <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01205"></a>01205           <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(l,l, s);
<a name="l01206"></a>01206           s = 1.0/(s*ul);                                       <span class="comment">// betta</span>
<a name="l01207"></a>01207           <span class="keywordflow">for</span> (j=l+1; j&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; j++)                                <span class="comment">// |&lt;-- processing &quot;Rp/Ap&quot;-block</span>
<a name="l01208"></a>01208             {                                                   <span class="comment">// |</span>
<a name="l01209"></a>01209               g = ul*<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,j);                               <span class="comment">// |</span>
<a name="l01210"></a>01210               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01211"></a>01211               (*Rp)(l,j)+=s*g*ul;                               <span class="comment">// |</span>
<a name="l01212"></a>01212               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01213"></a>01213             };                                                  <span class="comment">// |_________________________</span>
<a name="l01214"></a>01214           <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; j++)                                  <span class="comment">// |&lt;-- processing &quot;Rpx/Ax&quot;-block</span>
<a name="l01215"></a>01215             {                                                   <span class="comment">// |</span>
<a name="l01216"></a>01216               g = ul*<a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,j);                              <span class="comment">// |</span>
<a name="l01217"></a>01217               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01218"></a>01218               (*Rpx)(l,j)+=s*g*ul;                              <span class="comment">// |</span>
<a name="l01219"></a>01219               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01220"></a>01220             };                                                  <span class="comment">// |_________________________</span>
<a name="l01221"></a>01221           <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)                                  <span class="comment">// |&lt;-- processing &quot;Rpy/Ay&quot;-block</span>
<a name="l01222"></a>01222             {                                                   <span class="comment">// |</span>
<a name="l01223"></a>01223               g = ul*<a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,j);                              <span class="comment">// |</span>
<a name="l01224"></a>01224               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01225"></a>01225               (*Rpy)(l,j)+=s*g*ul;                              <span class="comment">// |</span>
<a name="l01226"></a>01226               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01227"></a>01227             };                                                  <span class="comment">// |_________________________</span>
<a name="l01228"></a>01228 
<a name="l01229"></a>01229           g = ul*<a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l);                                     <span class="comment">// |--</span>
<a name="l01230"></a>01230           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);            <span class="comment">// | dealing with the vectors Zp</span>
<a name="l01231"></a>01231           (*Zp)(l)+=s*g*ul;                                     <span class="comment">// |            and Z</span>
<a name="l01232"></a>01232           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>)(i)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);           <span class="comment">// |--</span>
<a name="l01233"></a>01233         };
<a name="l01234"></a>01234     };
<a name="l01235"></a>01235 
<a name="l01236"></a>01236 
<a name="l01237"></a>01237   <span class="comment">// Pass two: dealing with the &quot;x&quot;:</span>
<a name="l01238"></a>01238   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a363629d3609484eff973967c05f49269">clear</a>();                                                   <span class="comment">// U-vector, + ul -- the first elementh of U</span>
<a name="l01239"></a>01239   <span class="keywordflow">for</span> (l=0; l&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; l++)
<a name="l01240"></a>01240     {
<a name="l01241"></a>01241       s = <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l)*<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l);
<a name="l01242"></a>01242       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) s+=<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01243"></a>01243       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01244"></a>01244         {
<a name="l01245"></a>01245           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l))*sqrt(s);
<a name="l01246"></a>01246           ul = <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l) - s;                                 <span class="comment">// U_l</span>
<a name="l01247"></a>01247           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));          <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01248"></a>01248           <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(l,l, s);
<a name="l01249"></a>01249           s = 1.0/(s*ul);                                       <span class="comment">// betta</span>
<a name="l01250"></a>01250           <span class="keywordflow">for</span> (j=l+1; j&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; j++)                                <span class="comment">// |&lt;-- processing &quot;Rx/Ax&quot;-block</span>
<a name="l01251"></a>01251             {                                                   <span class="comment">// |</span>
<a name="l01252"></a>01252               g = ul*<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,j);                               <span class="comment">// |</span>
<a name="l01253"></a>01253               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01254"></a>01254               (*Rx)(l,j)+=s*g*ul;                               <span class="comment">// |</span>
<a name="l01255"></a>01255               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01256"></a>01256             };                                                  <span class="comment">// |_________________________</span>
<a name="l01257"></a>01257           <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)                                  <span class="comment">// |&lt;-- processing &quot;Rxy/Ay&quot;-block</span>
<a name="l01258"></a>01258             {                                                   <span class="comment">// |</span>
<a name="l01259"></a>01259               g = ul*<a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,j);                              <span class="comment">// |</span>
<a name="l01260"></a>01260               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01261"></a>01261               (*Rxy)(l,j)+=s*g*ul;                              <span class="comment">// |</span>
<a name="l01262"></a>01262               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01263"></a>01263             };                                                  <span class="comment">// |_________________________</span>
<a name="l01264"></a>01264 
<a name="l01265"></a>01265           g = ul*<a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l);                                     <span class="comment">// |--</span>
<a name="l01266"></a>01266           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);            <span class="comment">// | dealing with the vectors Zx</span>
<a name="l01267"></a>01267           (*Zx)(l)+=s*g*ul;                                     <span class="comment">// |            and Z</span>
<a name="l01268"></a>01268           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>)(i)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);           <span class="comment">// |--</span>
<a name="l01269"></a>01269         };
<a name="l01270"></a>01270     };
<a name="l01271"></a>01271 
<a name="l01272"></a>01272 
<a name="l01273"></a>01273   <span class="comment">// Pass three: dealing with the &quot;y&quot;:</span>
<a name="l01274"></a>01274   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a363629d3609484eff973967c05f49269">clear</a>();                                                   <span class="comment">// U-vector, + ul -- the first elementh of U</span>
<a name="l01275"></a>01275   <span class="keywordflow">for</span> (l=0; l&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; l++)
<a name="l01276"></a>01276     {
<a name="l01277"></a>01277       s = <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l)*<a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l);
<a name="l01278"></a>01278       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) s+=<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01279"></a>01279       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01280"></a>01280         {
<a name="l01281"></a>01281           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l))*sqrt(s);
<a name="l01282"></a>01282           ul = <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l) - s;                                 <span class="comment">// U_l</span>
<a name="l01283"></a>01283           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));          <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01284"></a>01284           <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(l,l, s);
<a name="l01285"></a>01285           s = 1.0/(s*ul);                                       <span class="comment">// betta</span>
<a name="l01286"></a>01286           <span class="keywordflow">for</span> (j=l+1; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)                                <span class="comment">// |&lt;-- processing &quot;Ry/Ay&quot;-block</span>
<a name="l01287"></a>01287             {                                                   <span class="comment">// |</span>
<a name="l01288"></a>01288               g = ul*<a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,j);                               <span class="comment">// |</span>
<a name="l01289"></a>01289               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01290"></a>01290               (*Ry)(l,j)+=s*g*ul;                               <span class="comment">// |</span>
<a name="l01291"></a>01291               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01292"></a>01292             };                                                  <span class="comment">// |_________________________</span>
<a name="l01293"></a>01293 
<a name="l01294"></a>01294           g = ul*<a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l);                                     <span class="comment">// |--</span>
<a name="l01295"></a>01295           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);            <span class="comment">// | dealing with the vectors Zy</span>
<a name="l01296"></a>01296           (*Zy)(l)+=s*g*ul;                                     <span class="comment">// |            and Z</span>
<a name="l01297"></a>01297           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>)(i)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);           <span class="comment">// |--</span>
<a name="l01298"></a>01298         }
<a name="l01299"></a>01299       <span class="keywordflow">else</span>
<a name="l01300"></a>01300         <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01301"></a>01301                    <span class="stringliteral">&quot;: got a zero during pass three at l[&quot;</span> + QString().setNum(l) + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l01302"></a>01302     };
<a name="l01303"></a>01303   
<a name="l01304"></a>01304   s = 0.0;
<a name="l01305"></a>01305   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) 
<a name="l01306"></a>01306     s+= <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);
<a name="l01307"></a>01307 
<a name="l01308"></a>01308   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#a353dca33423ce4ecc61ca640a0338b4c">addWPFR</a>(s);
<a name="l01309"></a>01309   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#aae64882a9b8aaa90c9504acedafcdc38">addNumObs</a>(Nz);
<a name="l01310"></a>01310   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>())
<a name="l01311"></a>01311     {
<a name="l01312"></a>01312       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#a353dca33423ce4ecc61ca640a0338b4c">addWPFR</a>(s);
<a name="l01313"></a>01313       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#aae64882a9b8aaa90c9504acedafcdc38">addNumObs</a>(Nz);
<a name="l01314"></a>01314     };
<a name="l01315"></a>01315   
<a name="l01316"></a>01316   Nz = 0;
<a name="l01317"></a>01317 };
<a name="l01318"></a>01318 
<a name="l01319"></a><a class="code" href="classSBEstimator.html#a6d1dedabe7b3e921825b59e370a9c3cb">01319</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a6d1dedabe7b3e921825b59e370a9c3cb">SBEstimator::dataUpdateGlobalConstr</a>()
<a name="l01320"></a>01320 {
<a name="l01321"></a>01321   <span class="comment">// make a Householder transformation</span>
<a name="l01322"></a>01322   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i,j,l;
<a name="l01323"></a>01323   <span class="keywordtype">double</span>        s,ul,g;
<a name="l01324"></a>01324   
<a name="l01325"></a>01325   
<a name="l01326"></a>01326   <span class="comment">// Pass one: dealing with the &quot;p&quot;:</span>
<a name="l01327"></a>01327   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a363629d3609484eff973967c05f49269">clear</a>();                                                   <span class="comment">// U-vector, + ul -- the first elementh of U</span>
<a name="l01328"></a>01328   <span class="keywordflow">for</span> (l=0; l&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; l++)
<a name="l01329"></a>01329     {
<a name="l01330"></a>01330       s = <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l)*<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l);
<a name="l01331"></a>01331       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) s+=<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01332"></a>01332       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01333"></a>01333         {
<a name="l01334"></a>01334           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l))*sqrt(s);
<a name="l01335"></a>01335           ul = <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l) - s;                                 <span class="comment">// U_l</span>
<a name="l01336"></a>01336           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));          <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01337"></a>01337           <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(l,l, s);
<a name="l01338"></a>01338           s = 1.0/(s*ul);                                       <span class="comment">// betta</span>
<a name="l01339"></a>01339           <span class="keywordflow">for</span> (j=l+1; j&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; j++)                                <span class="comment">// |&lt;-- processing &quot;Rp/Ap&quot;-block</span>
<a name="l01340"></a>01340             {                                                   <span class="comment">// |</span>
<a name="l01341"></a>01341               g = ul*<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,j);                               <span class="comment">// |</span>
<a name="l01342"></a>01342               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01343"></a>01343               (*Rp)(l,j)+=s*g*ul;                               <span class="comment">// |</span>
<a name="l01344"></a>01344               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#a50bc50ca31e48264052151bb839b4973">Ap</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01345"></a>01345             };                                                  <span class="comment">// |_________________________</span>
<a name="l01346"></a>01346           <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; j++)                                  <span class="comment">// |&lt;-- processing &quot;Rpx/Ax&quot;-block</span>
<a name="l01347"></a>01347             {                                                   <span class="comment">// |</span>
<a name="l01348"></a>01348               g = ul*<a class="code" href="classSBEstimator.html#a0c252e99e878db4cc1aebf7d343c1606">Rpx</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,j);                              <span class="comment">// |</span>
<a name="l01349"></a>01349               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01350"></a>01350               (*Rpx)(l,j)+=s*g*ul;                              <span class="comment">// |</span>
<a name="l01351"></a>01351               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01352"></a>01352             };                                                  <span class="comment">// |_________________________</span>
<a name="l01353"></a>01353           <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; j++)                               <span class="comment">// |&lt;-- processing &quot;Rpy/Ay&quot;-block</span>
<a name="l01354"></a>01354             {                                                   <span class="comment">// |</span>
<a name="l01355"></a>01355               g = ul*<a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,j);                              <span class="comment">// |</span>
<a name="l01356"></a>01356               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01357"></a>01357               (*Rpy)(l,j)+=s*g*ul;                              <span class="comment">// |</span>
<a name="l01358"></a>01358               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01359"></a>01359             };                                                  <span class="comment">// |_________________________</span>
<a name="l01360"></a>01360 
<a name="l01361"></a>01361           g = ul*<a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l);                                     <span class="comment">// |--</span>
<a name="l01362"></a>01362           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);            <span class="comment">// | dealing with the vectors Zp</span>
<a name="l01363"></a>01363           (*Zp)(l)+=s*g*ul;                                     <span class="comment">// |            and Z</span>
<a name="l01364"></a>01364           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>)(i)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);           <span class="comment">// |--</span>
<a name="l01365"></a>01365         };
<a name="l01366"></a>01366     };
<a name="l01367"></a>01367 
<a name="l01368"></a>01368 
<a name="l01369"></a>01369   <span class="comment">// Pass two: dealing with the &quot;x&quot;:</span>
<a name="l01370"></a>01370   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a363629d3609484eff973967c05f49269">clear</a>();                                                   <span class="comment">// U-vector, + ul -- the first elementh of U</span>
<a name="l01371"></a>01371   <span class="keywordflow">for</span> (l=0; l&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; l++)
<a name="l01372"></a>01372     {
<a name="l01373"></a>01373       s = <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l)*<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l);
<a name="l01374"></a>01374       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) s+=<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01375"></a>01375       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01376"></a>01376         {
<a name="l01377"></a>01377           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l))*sqrt(s);
<a name="l01378"></a>01378           ul = <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l) - s;                                 <span class="comment">// U_l</span>
<a name="l01379"></a>01379           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));          <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01380"></a>01380           <a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(l,l, s);
<a name="l01381"></a>01381           s = 1.0/(s*ul);                                       <span class="comment">// betta</span>
<a name="l01382"></a>01382           <span class="keywordflow">for</span> (j=l+1; j&lt;<a class="code" href="classSBEstimator.html#acacd42ef2bade53377846c203226558c">Nx</a>; j++)                                <span class="comment">// |&lt;-- processing &quot;Rx/Ax&quot;-block</span>
<a name="l01383"></a>01383             {                                                   <span class="comment">// |</span>
<a name="l01384"></a>01384               g = ul*<a class="code" href="classSBEstimator.html#aa0e548ef50630c03f6d415ca455878d1">Rx</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,j);                               <span class="comment">// |</span>
<a name="l01385"></a>01385               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01386"></a>01386               (*Rx)(l,j)+=s*g*ul;                               <span class="comment">// |</span>
<a name="l01387"></a>01387               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ad27b6e53762f159e44a2eb73e51551d7">Ax</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01388"></a>01388             };                                                  <span class="comment">// |_________________________</span>
<a name="l01389"></a>01389           <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; j++)                               <span class="comment">// |&lt;-- processing &quot;Rxy/Ay&quot;-block</span>
<a name="l01390"></a>01390             {                                                   <span class="comment">// |</span>
<a name="l01391"></a>01391               g = ul*<a class="code" href="classSBEstimator.html#aeb660281311e7e9ceb71fd730dc0abdf">Rxy</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,j);                              <span class="comment">// |</span>
<a name="l01392"></a>01392               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01393"></a>01393               (*Rxy)(l,j)+=s*g*ul;                              <span class="comment">// |</span>
<a name="l01394"></a>01394               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01395"></a>01395             };                                                  <span class="comment">// |_________________________</span>
<a name="l01396"></a>01396 
<a name="l01397"></a>01397           g = ul*<a class="code" href="classSBEstimator.html#a62a6339f7dba178331d5772d8b33807e">Zx</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l);                                     <span class="comment">// |--</span>
<a name="l01398"></a>01398           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);            <span class="comment">// | dealing with the vectors Zx</span>
<a name="l01399"></a>01399           (*Zx)(l)+=s*g*ul;                                     <span class="comment">// |            and Z</span>
<a name="l01400"></a>01400           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>)(i)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);           <span class="comment">// |--</span>
<a name="l01401"></a>01401         };
<a name="l01402"></a>01402     };
<a name="l01403"></a>01403 
<a name="l01404"></a>01404 
<a name="l01405"></a>01405   <span class="comment">// Pass three: dealing with the &quot;y&quot;:</span>
<a name="l01406"></a>01406   <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a363629d3609484eff973967c05f49269">clear</a>();                                                   <span class="comment">// U-vector, + ul -- the first elementh of U</span>
<a name="l01407"></a>01407   <span class="keywordflow">for</span> (l=0; l&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; l++)
<a name="l01408"></a>01408     {
<a name="l01409"></a>01409       s = <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l)*<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l);
<a name="l01410"></a>01410       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) s+=<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01411"></a>01411       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01412"></a>01412         {
<a name="l01413"></a>01413           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l))*sqrt(s);
<a name="l01414"></a>01414           ul = <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l) - s;                              <span class="comment">// U_l</span>
<a name="l01415"></a>01415           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) <a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, <a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));          <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01416"></a>01416           <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(l,l, s);
<a name="l01417"></a>01417           s = 1.0/(s*ul);                                       <span class="comment">// betta</span>
<a name="l01418"></a>01418           <span class="keywordflow">for</span> (j=l+1; j&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; j++)                             <span class="comment">// |&lt;-- processing &quot;Ry/Ay&quot;-block</span>
<a name="l01419"></a>01419             {                                                   <span class="comment">// |</span>
<a name="l01420"></a>01420               g = ul*<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,j);                            <span class="comment">// |</span>
<a name="l01421"></a>01421               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);     <span class="comment">// |</span>
<a name="l01422"></a>01422               (*RyAll)(l,j)+=s*g*ul;                            <span class="comment">// |</span>
<a name="l01423"></a>01423               <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#ae13b91c883b3966fb781f3aefe2937b9">Ay</a>)(i,j)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);    <span class="comment">// |</span>
<a name="l01424"></a>01424             };                                                  <span class="comment">// |_________________________</span>
<a name="l01425"></a>01425           
<a name="l01426"></a>01426           g = ul*<a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l);                                  <span class="comment">// |--</span>
<a name="l01427"></a>01427           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) g+=<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);            <span class="comment">// | dealing with the vectors Zy</span>
<a name="l01428"></a>01428           (*ZyAll)(l)+=s*g*ul;                                  <span class="comment">// |            and Z</span>
<a name="l01429"></a>01429           <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) (*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>)(i)+=s*g*<a class="code" href="classSBEstimator.html#a15b91ff545e21332c1db5f307b382777">U</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);           <span class="comment">// |--</span>
<a name="l01430"></a>01430         }
<a name="l01431"></a>01431       <span class="keywordflow">else</span>
<a name="l01432"></a>01432         <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01433"></a>01433                    <span class="stringliteral">&quot;: got a zero during pass three at l[&quot;</span> + QString().setNum(l) + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l01434"></a>01434     };
<a name="l01435"></a>01435   
<a name="l01436"></a>01436   s = 0.0;
<a name="l01437"></a>01437   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae2a736d62fb2858abf5664eb490ec426">Nz</a>; i++) 
<a name="l01438"></a>01438     s+= <a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*<a class="code" href="classSBEstimator.html#aa1bd4b386c1d7258c0174ea7ce860d47">Z</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);
<a name="l01439"></a>01439 
<a name="l01440"></a>01440   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#a353dca33423ce4ecc61ca640a0338b4c">addWPFR</a>(s);
<a name="l01441"></a>01441   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#aae64882a9b8aaa90c9504acedafcdc38">addNumObs</a>(Nz);
<a name="l01442"></a>01442   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>())
<a name="l01443"></a>01443     {
<a name="l01444"></a>01444       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#a353dca33423ce4ecc61ca640a0338b4c">addWPFR</a>(s);
<a name="l01445"></a>01445       <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#aae64882a9b8aaa90c9504acedafcdc38">addNumObs</a>(Nz);
<a name="l01446"></a>01446     };
<a name="l01447"></a>01447   
<a name="l01448"></a>01448   Nz = 0;
<a name="l01449"></a>01449 };
<a name="l01450"></a>01450 
<a name="l01451"></a>01451 <span class="preprocessor">#include &lt;qapplication.h&gt;</span>
<a name="l01452"></a><a class="code" href="classSBEstimator.html#ac55ff956af2253d9f14d60dfe508f114">01452</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#ac55ff956af2253d9f14d60dfe508f114">SBEstimator::moveGlobalInfo</a>()
<a name="l01453"></a>01453 {
<a name="l01454"></a>01454   
<a name="l01455"></a>01455   <a class="code" href="classSBParameter.html">SBParameter</a>   *Par;
<a name="l01456"></a>01456   <span class="keywordtype">int</span>           idx;
<a name="l01457"></a>01457   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i,j,l;
<a name="l01458"></a>01458   <span class="keywordtype">int</span>           *Idx = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>+1];           <span class="comment">// an indexes of elements of Ys into YsAll</span>
<a name="l01459"></a>01459   <span class="keywordtype">int</span>           *IdxRev = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>];       <span class="comment">// </span>
<a name="l01460"></a>01460   <span class="keywordtype">double</span>        s,ul,g;
<a name="l01461"></a>01461   
<a name="l01462"></a>01462   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: starting transfer global info&quot;</span>);
<a name="l01463"></a>01463   qApp-&gt;processEvents();
<a name="l01464"></a>01464 
<a name="l01465"></a>01465   <span class="keywordflow">for</span> (i = 0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l01466"></a>01466     <span class="keywordflow">if</span> ((idx = <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;<a class="code" href="classSBParameterList.html#a925d2f705ca13c982d0511be8e503f91">idx</a>( (Par=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;at(i)) ))!=-1)
<a name="l01467"></a>01467       *(Idx+i) = idx;
<a name="l01468"></a>01468     <span class="keywordflow">else</span>
<a name="l01469"></a>01469       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01470"></a>01470                  <span class="stringliteral">&quot;: cannot find the global parameter [&quot;</span> + Par-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>() + 
<a name="l01471"></a>01471                  <span class="stringliteral">&quot;] in the list of all global parameters&quot;</span>);
<a name="l01472"></a>01472   *(Idx+<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>)=<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>+1;
<a name="l01473"></a>01473   j = 0;
<a name="l01474"></a>01474   <span class="keywordflow">for</span> (i = 0; i&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; i++)
<a name="l01475"></a>01475     {
<a name="l01476"></a>01476       <span class="keywordflow">if</span> (*(Idx+j)==(int)i)
<a name="l01477"></a>01477         j++;
<a name="l01478"></a>01478       *(IdxRev+i) = j - 1;
<a name="l01479"></a>01479       <span class="keywordflow">if</span> (j&gt;Ny)
<a name="l01480"></a>01480         <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: ERROR IN IDXes ORDER.&quot;</span>);
<a name="l01481"></a>01481     };
<a name="l01482"></a>01482   
<a name="l01483"></a>01483   <a class="code" href="classSBMatrix.html">SBMatrix</a>      *R_= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(Ny, NyAll, <span class="stringliteral">&quot;R_&quot;</span>);     <span class="comment">// this is Ry</span>
<a name="l01484"></a>01484   <a class="code" href="classSBVector.html">SBVector</a>      *Z_= <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(Ny, <span class="stringliteral">&quot;Z_&quot;</span>);            <span class="comment">// this is Zy</span>
<a name="l01485"></a>01485   <a class="code" href="classSBVector.html">SBVector</a>      *U_= <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(Ny, <span class="stringliteral">&quot;U_&quot;</span>);
<a name="l01486"></a>01486   
<a name="l01487"></a>01487   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: transfer global info: mapping&quot;</span>);
<a name="l01488"></a>01488   qApp-&gt;processEvents();
<a name="l01489"></a>01489 
<a name="l01490"></a>01490   *Z_ = *<a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a>;
<a name="l01491"></a>01491   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l01492"></a>01492     {
<a name="l01493"></a>01493       <span class="comment">//      Z_-&gt;set(i, Zy-&gt;at(i));</span>
<a name="l01494"></a>01494       <span class="keywordflow">for</span> (j=i; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)
<a name="l01495"></a>01495         R_-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, *(Idx+j),  <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(i,j));
<a name="l01496"></a>01496     };
<a name="l01497"></a>01497   
<a name="l01498"></a>01498   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: transfer global info: Householdering&quot;</span>);
<a name="l01499"></a>01499   qApp-&gt;processEvents();
<a name="l01500"></a>01500 
<a name="l01501"></a>01501   <span class="comment">// Householdering:</span>
<a name="l01502"></a>01502   <span class="keywordflow">for</span> (l=0; l&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; l++)
<a name="l01503"></a>01503     {
<a name="l01504"></a>01504       s = 0.0;
<a name="l01505"></a>01505       <span class="keywordflow">for</span> (i=0; (int)i&lt;=*(IdxRev+l); i++) 
<a name="l01506"></a>01506         s+=R_-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*R_-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01507"></a>01507       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01508"></a>01508         {
<a name="l01509"></a>01509           s += <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l)*<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l);
<a name="l01510"></a>01510           
<a name="l01511"></a>01511           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l))*sqrt(s);
<a name="l01512"></a>01512           ul = <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l) - s;                                              <span class="comment">// U_l</span>
<a name="l01513"></a>01513           <span class="keywordflow">for</span> (i=0; (int)i&lt;=*(IdxRev+l); i++) U_-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, R_-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));          <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01514"></a>01514           <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(l,l, s);
<a name="l01515"></a>01515           s = 1.0/(s*ul);                                                       <span class="comment">// betta  !add betta!</span>
<a name="l01516"></a>01516           <span class="keywordflow">for</span> (j=l+1; j&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; j++)
<a name="l01517"></a>01517             {
<a name="l01518"></a>01518               g = ul*<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,j);
<a name="l01519"></a>01519               <span class="keywordflow">for</span> (i=0; (int)i&lt;=*(IdxRev+l); i++) 
<a name="l01520"></a>01520                 g+=U_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*R_-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);
<a name="l01521"></a>01521               (*RyAll)(l,j)+=s*g*ul;
<a name="l01522"></a>01522               <span class="keywordflow">for</span> (i=0; (int)i&lt;=*(IdxRev+l); i++) 
<a name="l01523"></a>01523                 (*R_)(i,j)+=s*g*U_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);
<a name="l01524"></a>01524             };
<a name="l01525"></a>01525           g = ul*<a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l);                                  <span class="comment">// |--</span>
<a name="l01526"></a>01526           <span class="keywordflow">for</span> (i=0; (int)i&lt;=*(IdxRev+l); i++)                           <span class="comment">// |</span>
<a name="l01527"></a>01527             g+=U_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*Z_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);                                     <span class="comment">// | dealing with the vectors ZyAll</span>
<a name="l01528"></a>01528           (*ZyAll)(l)+=s*g*ul;                                  <span class="comment">// |            and Zy</span>
<a name="l01529"></a>01529           <span class="keywordflow">for</span> (i=0; (int)i&lt;=*(IdxRev+l); i++)                           <span class="comment">// |</span>
<a name="l01530"></a>01530             (*Z_)(i)+=s*g*U_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);                            <span class="comment">// |--</span>
<a name="l01531"></a>01531         };
<a name="l01532"></a>01532     };
<a name="l01533"></a>01533   
<a name="l01534"></a>01534   <span class="comment">// here need to add Z_ to the vector E:</span>
<a name="l01535"></a>01535   <span class="comment">// Z_-&gt;module(); ???</span>
<a name="l01536"></a>01536   
<a name="l01537"></a>01537   s = 0.0;
<a name="l01538"></a>01538   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++) 
<a name="l01539"></a>01539     s+= Z_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*Z_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);
<a name="l01540"></a>01540 
<a name="l01541"></a>01541   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#a353dca33423ce4ecc61ca640a0338b4c">addWPFR</a>(s);
<a name="l01542"></a>01542   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>())
<a name="l01543"></a>01543     <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#a353dca33423ce4ecc61ca640a0338b4c">addWPFR</a>(s);
<a name="l01544"></a>01544   
<a name="l01545"></a>01545   <span class="keyword">delete</span>[] Idx;
<a name="l01546"></a>01546   <span class="keyword">delete</span>[] IdxRev;
<a name="l01547"></a>01547   <span class="keyword">delete</span> R_;
<a name="l01548"></a>01548   <span class="keyword">delete</span> Z_;
<a name="l01549"></a>01549   <span class="keyword">delete</span> U_;
<a name="l01550"></a>01550 
<a name="l01551"></a>01551   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: transfer of global info finished&quot;</span>);
<a name="l01552"></a>01552 };
<a name="l01553"></a>01553 
<a name="l01554"></a><a class="code" href="classSBEstimator.html#a2bbe9c874ee79070e3d3ef68b4185424">01554</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a2bbe9c874ee79070e3d3ef68b4185424">SBEstimator::moveGlobalInfo_Old</a>()
<a name="l01555"></a>01555 {
<a name="l01556"></a>01556   
<a name="l01557"></a>01557   <a class="code" href="classSBParameter.html">SBParameter</a>   *Par;
<a name="l01558"></a>01558   <span class="keywordtype">int</span>           idx;
<a name="l01559"></a>01559   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i,j,l;
<a name="l01560"></a>01560   <span class="keywordtype">int</span>           *Idx = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>];     <span class="comment">// an indexes of elements of Ys into YsAll</span>
<a name="l01561"></a>01561   <span class="keywordtype">double</span>        s,ul,g;
<a name="l01562"></a>01562   
<a name="l01563"></a>01563   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: starting transfer global info&quot;</span>);
<a name="l01564"></a>01564   qApp-&gt;processEvents();
<a name="l01565"></a>01565 
<a name="l01566"></a>01566   <span class="keywordflow">for</span> (i = 0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l01567"></a>01567     <span class="keywordflow">if</span> ((idx = <a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;<a class="code" href="classSBParameterList.html#a925d2f705ca13c982d0511be8e503f91">idx</a>( (Par=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;at(i)) ))!=-1)
<a name="l01568"></a>01568       *(Idx+i) = idx;
<a name="l01569"></a>01569     <span class="keywordflow">else</span>
<a name="l01570"></a>01570       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01571"></a>01571                  <span class="stringliteral">&quot;: cannot find the global parameter [&quot;</span> + Par-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>() + 
<a name="l01572"></a>01572                  <span class="stringliteral">&quot;] in the list of all global parameters&quot;</span>);
<a name="l01573"></a>01573   
<a name="l01574"></a>01574   <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a> *R_= <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;R_&quot;</span>);    <span class="comment">// this is Ry</span>
<a name="l01575"></a>01575   <a class="code" href="classSBVector.html">SBVector</a>      *Z_= <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;Z_&quot;</span>);         <span class="comment">// this is Zy</span>
<a name="l01576"></a>01576   <a class="code" href="classSBVector.html">SBVector</a>      *U_= <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;U_&quot;</span>);
<a name="l01577"></a>01577   
<a name="l01578"></a>01578   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: transfer global info: mapping&quot;</span>);
<a name="l01579"></a>01579   qApp-&gt;processEvents();
<a name="l01580"></a>01580 
<a name="l01581"></a>01581   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l01582"></a>01582     {
<a name="l01583"></a>01583       Z_-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>( *(Idx+i), <a class="code" href="classSBEstimator.html#ae6e629e56be1fe54c11d731a19b0326e">Zy</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i));
<a name="l01584"></a>01584       <span class="keywordflow">for</span> (j=i; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)
<a name="l01585"></a>01585         R_-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(*(Idx+i),*(Idx+j),  <a class="code" href="classSBEstimator.html#a02611ffe4cc8dafe99d7aea0871540d2">Ry</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(i,j));
<a name="l01586"></a>01586     };
<a name="l01587"></a>01587   
<a name="l01588"></a>01588   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: transfer global info: Householdering&quot;</span>);
<a name="l01589"></a>01589   qApp-&gt;processEvents();
<a name="l01590"></a>01590 
<a name="l01591"></a>01591   <span class="comment">// Householdering:</span>
<a name="l01592"></a>01592   <span class="keywordflow">for</span> (l=0; l&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; l++)
<a name="l01593"></a>01593     {
<a name="l01594"></a>01594       s = <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l)*<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l);
<a name="l01595"></a>01595       <span class="keywordflow">for</span> (i=0; i&lt;=l; i++) s+=R_-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(i,l)*R_-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(i,l);
<a name="l01596"></a>01596       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01597"></a>01597         {
<a name="l01598"></a>01598           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l))*sqrt(s);
<a name="l01599"></a>01599           ul = <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,l) - s;                              <span class="comment">// U_l</span>
<a name="l01600"></a>01600           <span class="keywordflow">for</span> (i=0; i&lt;=l; i++) U_-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, R_-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(i,l));         <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01601"></a>01601           <a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(l,l, s);
<a name="l01602"></a>01602           s = 1.0/(s*ul);                                       <span class="comment">// betta  !add betta!</span>
<a name="l01603"></a>01603           <span class="keywordflow">for</span> (j=l+1; j&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; j++)
<a name="l01604"></a>01604             {
<a name="l01605"></a>01605               g = ul*<a class="code" href="classSBEstimator.html#ac6ba2c4342adfa45a4cec04214cc80a7">RyAll</a>-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(l,j);
<a name="l01606"></a>01606               <span class="keywordflow">for</span> (i=0; i&lt;=l; i++) g+=U_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*R_-&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(i,j);
<a name="l01607"></a>01607               (*RyAll)(l,j)+=s*g*ul;
<a name="l01608"></a>01608               <span class="keywordflow">for</span> (i=0; i&lt;=l; i++) (*R_)(i,j)+=s*g*U_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);
<a name="l01609"></a>01609             };
<a name="l01610"></a>01610           g = ul*<a class="code" href="classSBEstimator.html#a8e40a866849490e190fc5d9bf53d9203">ZyAll</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l);                                  <span class="comment">// |--</span>
<a name="l01611"></a>01611           <span class="keywordflow">for</span> (i=0; i&lt;=l; i++) g+=U_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*Z_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);          <span class="comment">// | dealing with the vectors ZyAll</span>
<a name="l01612"></a>01612           (*ZyAll)(l)+=s*g*ul;                                  <span class="comment">// |            and Zy</span>
<a name="l01613"></a>01613           <span class="keywordflow">for</span> (i=0; i&lt;=l; i++) (*Z_)(i)+=s*g*U_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);         <span class="comment">// |--</span>
<a name="l01614"></a>01614         };
<a name="l01615"></a>01615     };
<a name="l01616"></a>01616 
<a name="l01617"></a>01617   <span class="comment">// here need to add Z_ to the vector E:</span>
<a name="l01618"></a>01618   <span class="comment">// Z_-&gt;module(); ???</span>
<a name="l01619"></a>01619 
<a name="l01620"></a>01620   s = 0.0;
<a name="l01621"></a>01621   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; i++) 
<a name="l01622"></a>01622     s+= Z_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*Z_-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);
<a name="l01623"></a>01623 
<a name="l01624"></a>01624   <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a790ac10772a10714f85ef0b2db85d4dc">statGeneral</a>()-&gt;<a class="code" href="classSBStatistics.html#a353dca33423ce4ecc61ca640a0338b4c">addWPFR</a>(s);
<a name="l01625"></a>01625   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>())
<a name="l01626"></a>01626     <a class="code" href="classSBEstimator.html#a918f638bd8e5c20013bf48f514dbf277">Solution</a>-&gt;<a class="code" href="classSBSolution.html#a933a10f8133e109eedb5666e2d979271">stat4CurrentBatch</a>()-&gt;<a class="code" href="classSBStatistics.html#a353dca33423ce4ecc61ca640a0338b4c">addWPFR</a>(s);
<a name="l01627"></a>01627   
<a name="l01628"></a>01628   <span class="keyword">delete</span>[] Idx;
<a name="l01629"></a>01629   <span class="keyword">delete</span> R_;
<a name="l01630"></a>01630   <span class="keyword">delete</span> Z_;
<a name="l01631"></a>01631   <span class="keyword">delete</span> U_;
<a name="l01632"></a>01632 
<a name="l01633"></a>01633   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: transfer of global info finished&quot;</span>);
<a name="l01634"></a>01634 };
<a name="l01635"></a>01635 
<a name="l01636"></a><a class="code" href="classSBEstimator.html#a6177e5a36d4868bfa9718d95e9f534d4">01636</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a6177e5a36d4868bfa9718d95e9f534d4">SBEstimator::collectContStochs4NextBatch</a>()
<a name="l01637"></a>01637 {
<a name="l01638"></a>01638   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i,j;
<a name="l01639"></a>01639   <span class="keywordtype">int</span>           *Idx_Y = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>];           <span class="comment">// an indexes of elements</span>
<a name="l01640"></a>01640 
<a name="l01641"></a>01641   <span class="comment">// delete them if they&#39;re exist still</span>
<a name="l01642"></a>01642   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#acdc81215f0e2648e157bdbbd1b981fa7">ZpCont</a>)
<a name="l01643"></a>01643     <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#acdc81215f0e2648e157bdbbd1b981fa7">ZpCont</a>;
<a name="l01644"></a>01644   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aaddeaa5d35bd76467427e83102f4b1d4">RpCont</a>)
<a name="l01645"></a>01645     <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#aaddeaa5d35bd76467427e83102f4b1d4">RpCont</a>;
<a name="l01646"></a>01646   <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#abadd54d3b5c6e135257fa9a220afa1da">RpyCont</a>)
<a name="l01647"></a>01647     <span class="keyword">delete</span> <a class="code" href="classSBEstimator.html#abadd54d3b5c6e135257fa9a220afa1da">RpyCont</a>;
<a name="l01648"></a>01648   
<a name="l01649"></a>01649   <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a> -&gt;<a class="code" href="classSBParameterList.html#a323bc78dceb35f282e203f7b5ac1f502">clear</a>();
<a name="l01650"></a>01650 
<a name="l01651"></a>01651   <a class="code" href="classSBEstimator.html#acdc81215f0e2648e157bdbbd1b981fa7">ZpCont</a> = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, <span class="stringliteral">&quot;ZpCont&quot;</span>);
<a name="l01652"></a>01652   <a class="code" href="classSBEstimator.html#aaddeaa5d35bd76467427e83102f4b1d4">RpCont</a> = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, <span class="stringliteral">&quot;RpCont&quot;</span>);
<a name="l01653"></a>01653   <a class="code" href="classSBEstimator.html#abadd54d3b5c6e135257fa9a220afa1da">RpyCont</a>= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>, <a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>, <span class="stringliteral">&quot;RpyCont&quot;</span>);
<a name="l01654"></a>01654 
<a name="l01655"></a>01655   <span class="comment">// HAVE TO MAKE AN REARANGING OF PARAMETERS ORDER!</span>
<a name="l01656"></a>01656 
<a name="l01657"></a>01657 
<a name="l01658"></a>01658 
<a name="l01659"></a>01659   <span class="comment">// make copy of parameter lists:</span>
<a name="l01660"></a>01660   <span class="comment">//  std::cout &lt;&lt; &quot;parameters: \n&quot;;</span>
<a name="l01661"></a>01661   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; i++)
<a name="l01662"></a>01662     <span class="comment">//    {</span>
<a name="l01663"></a>01663     <span class="comment">//      std::cout &lt;&lt; Ps-&gt;at(i)-&gt;name() &lt;&lt; &quot;: &quot; &lt;&lt; QString().setNum(i) &lt;&lt; &quot;\n&quot;; </span>
<a name="l01664"></a>01664     <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;<a class="code" href="classSBParameterList.html#ada2b1da7bfbacc2f6bc7e7234aace0bc">append</a>(<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;at(i));
<a name="l01665"></a>01665   <span class="comment">//    };</span>
<a name="l01666"></a>01666   <span class="comment">//  std::cout &lt;&lt; &quot;\n&quot;;</span>
<a name="l01667"></a>01667 
<a name="l01668"></a>01668   <a class="code" href="classSBParameter.html">SBParameter</a>   *Par=NULL;
<a name="l01669"></a>01669   <span class="keywordtype">int</span>           *idx_y=Idx_Y;
<a name="l01670"></a>01670   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l01671"></a>01671     <span class="keywordflow">if</span> ( (*idx_y++=<a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;<a class="code" href="classSBParameterList.html#a925d2f705ca13c982d0511be8e503f91">idx</a>((Par=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;at(i))))==-1 )
<a name="l01672"></a>01672       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01673"></a>01673                  <span class="stringliteral">&quot;: cannot find the global parameter [&quot;</span> + Par-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>() + 
<a name="l01674"></a>01674                  <span class="stringliteral">&quot;] in the list of all global parameters&quot;</span>);
<a name="l01675"></a>01675   
<a name="l01676"></a>01676   <span class="comment">// make a copy of matrices &amp; vector:</span>
<a name="l01677"></a>01677   *<a class="code" href="classSBEstimator.html#acdc81215f0e2648e157bdbbd1b981fa7">ZpCont</a> = *<a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>;
<a name="l01678"></a>01678   *<a class="code" href="classSBEstimator.html#aaddeaa5d35bd76467427e83102f4b1d4">RpCont</a> = *<a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>;
<a name="l01679"></a>01679 
<a name="l01680"></a>01680   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#ae25eef2bca8252dc3de5cf698ec9ae1c">Np</a>; i++)
<a name="l01681"></a>01681     <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)
<a name="l01682"></a>01682       <a class="code" href="classSBEstimator.html#abadd54d3b5c6e135257fa9a220afa1da">RpyCont</a>-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, *(Idx_Y+j),   <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>( i, j) );
<a name="l01683"></a>01683 
<a name="l01684"></a>01684   <span class="keyword">delete</span>[] Idx_Y;
<a name="l01685"></a>01685   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01686"></a>01686              <span class="stringliteral">&quot;: stochastic parameters have been saved for next batch propagation&quot;</span>);
<a name="l01687"></a>01687 };
<a name="l01688"></a>01688 
<a name="l01689"></a><a class="code" href="classSBEstimator.html#a93f085ff46cc783af1e9bffd89ad8762">01689</a> <span class="keywordtype">void</span> <a class="code" href="classSBEstimator.html#a93f085ff46cc783af1e9bffd89ad8762">SBEstimator::mapContStochs4NewBatch</a>(<span class="keyword">const</span> <a class="code" href="classSBMJD.html">SBMJD</a>&amp; Tnew)
<a name="l01690"></a>01690 {
<a name="l01691"></a>01691   <span class="keywordflow">if</span> (!<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>)
<a name="l01692"></a>01692     {
<a name="l01693"></a>01693       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01694"></a>01694                  <span class="stringliteral">&quot;: the list of `continuous&#39; stochastic parameters is NULL&quot;</span>);
<a name="l01695"></a>01695       <span class="keywordflow">return</span>;
<a name="l01696"></a>01696     };
<a name="l01697"></a>01697   <span class="keywordflow">if</span> (!<a class="code" href="classSBEstimator.html#acdc81215f0e2648e157bdbbd1b981fa7">ZpCont</a>)
<a name="l01698"></a>01698     {
<a name="l01699"></a>01699       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01700"></a>01700                  <span class="stringliteral">&quot;: the vector Zp of `continuous&#39; stochastic parameters is NULL&quot;</span>);
<a name="l01701"></a>01701       <span class="keywordflow">return</span>;
<a name="l01702"></a>01702     };
<a name="l01703"></a>01703   <span class="keywordflow">if</span> (!<a class="code" href="classSBEstimator.html#aaddeaa5d35bd76467427e83102f4b1d4">RpCont</a>)
<a name="l01704"></a>01704     {
<a name="l01705"></a>01705       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01706"></a>01706                  <span class="stringliteral">&quot;: the matrix Rp of `continuous&#39; stochastic parameters is NULL&quot;</span>);
<a name="l01707"></a>01707       <span class="keywordflow">return</span>;
<a name="l01708"></a>01708     };
<a name="l01709"></a>01709   <span class="keywordflow">if</span> (!<a class="code" href="classSBEstimator.html#abadd54d3b5c6e135257fa9a220afa1da">RpyCont</a>)
<a name="l01710"></a>01710     {
<a name="l01711"></a>01711       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01712"></a>01712                  <span class="stringliteral">&quot;: the matrix Rpy of `continuous&#39; stochastic parameters is NULL&quot;</span>);
<a name="l01713"></a>01713       <span class="keywordflow">return</span>;
<a name="l01714"></a>01714     };
<a name="l01715"></a>01715 
<a name="l01716"></a>01716   <span class="comment">// now, propagate the stochastic parameters from an epoch &quot;TLastProcessed&quot; to a new one &quot;Tnew&quot;:</span>
<a name="l01717"></a>01717   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  i,j,l;
<a name="l01718"></a>01718   <span class="keywordtype">double</span>        s,g;
<a name="l01719"></a>01719   <span class="keywordtype">double</span>        dT = Tnew - <a class="code" href="classSBEstimator.html#abf4ac4a0c99b7788c04142f78646e2ac">TLastProcessed</a>;
<a name="l01720"></a>01720 
<a name="l01721"></a>01721   <a class="code" href="classSBParameterList.html">SBParameterList</a> *PsTmp = <span class="keyword">new</span> <a class="code" href="classSBParameterList.html">SBParameterList</a>; <span class="comment">// PsCont AND Ps</span>
<a name="l01722"></a>01722   PsTmp-&gt;setAutoDelete(FALSE);
<a name="l01723"></a>01723 
<a name="l01724"></a>01724   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;count(); i++)
<a name="l01725"></a>01725     <span class="keywordflow">if</span> (<a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>-&gt;<a class="code" href="classSBParameterList.html#a925d2f705ca13c982d0511be8e503f91">idx</a>(<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;at(i)) != -1 &amp;&amp; <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;at(i)-&gt;isAttr(<a class="code" href="classSBDerivation.html#a19607f8eddf33f7fbcc3fdaf9cd52e9bac4aff1d14cf20bbe45f253bb979ba35e" title="the parameter&#39;s info have to be propagated in future">SBDerivation::IsPropagated</a>))
<a name="l01726"></a>01726       PsTmp-&gt;<a class="code" href="classSBParameterList.html#ada2b1da7bfbacc2f6bc7e7234aace0bc">append</a>(<a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;at(i));
<a name="l01727"></a>01727   
<a name="l01728"></a>01728   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NumTmp = PsTmp-&gt;count();
<a name="l01729"></a>01729   <span class="keywordtype">int</span>           *Idx_POld = <span class="keyword">new</span> <span class="keywordtype">int</span>[NumTmp];
<a name="l01730"></a>01730   <span class="keywordtype">int</span>           *Idx_PNew = <span class="keyword">new</span> <span class="keywordtype">int</span>[NumTmp];
<a name="l01731"></a>01731   <span class="keywordtype">int</span>           *Idx_Y = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>];           <span class="comment">// an indexes of elements</span>
<a name="l01732"></a>01732   <span class="keywordflow">for</span> (i=0; i&lt;NumTmp; i++)
<a name="l01733"></a>01733     {
<a name="l01734"></a>01734       *(Idx_POld+i) = <a class="code" href="classSBEstimator.html#a11b8a9769f04ede595e48e4ea2a38040">PsCont</a>-&gt;<a class="code" href="classSBParameterList.html#a925d2f705ca13c982d0511be8e503f91">idx</a>(PsTmp-&gt;at(i));
<a name="l01735"></a>01735       *(Idx_PNew+i) = <a class="code" href="classSBEstimator.html#aae0d44238db5e1883f045115ecff87fd" title="list of stochastic parameters;">Ps</a>    -&gt;idx(PsTmp-&gt;at(i));
<a name="l01736"></a>01736     };  
<a name="l01737"></a>01737   
<a name="l01738"></a>01738   <a class="code" href="classSBParameter.html">SBParameter</a>   *Par=NULL;
<a name="l01739"></a>01739   <span class="keywordtype">int</span>           *idx_y=Idx_Y;
<a name="l01740"></a>01740   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; i++)
<a name="l01741"></a>01741     <span class="keywordflow">if</span> ( (*idx_y++=<a class="code" href="classSBEstimator.html#ab5686f6047c50c7f68c02938d3b49287" title="list of all global parameters;">YsAll</a>-&gt;<a class="code" href="classSBParameterList.html#a925d2f705ca13c982d0511be8e503f91">idx</a>((Par=<a class="code" href="classSBEstimator.html#a2ab733d5d9a02e997b9a6ec7d5c35e83" title="list of global parameters;">Ys</a>-&gt;at(i))))==-1 )
<a name="l01742"></a>01742       <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01743"></a>01743                  <span class="stringliteral">&quot;: cannot find the global parameter [&quot;</span> + Par-&gt;<a class="code" href="classSBNamed.html#a18c8ec200ec5ade83654d749c8123c1e">name</a>() + 
<a name="l01744"></a>01744                  <span class="stringliteral">&quot;] in the list of all global parameters&quot;</span>);
<a name="l01745"></a>01745 
<a name="l01746"></a>01746   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  n = 2*NumTmp, m = 2*NumTmp + <a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>;
<a name="l01747"></a>01747 
<a name="l01748"></a>01748   <span class="comment">// for tieing parameters between batches:</span>
<a name="l01749"></a>01749   <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a> *Rp_sCont = <span class="keyword">new</span> <a class="code" href="classSBUpperMatrix.html">SBUpperMatrix</a>(NumTmp, <span class="stringliteral">&quot;Rp_sCont&quot;</span>);
<a name="l01750"></a>01750   <a class="code" href="classSBMatrix.html">SBMatrix</a>      *Rpp_sCont= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(NumTmp, NumTmp, <span class="stringliteral">&quot;Rpp_sCont&quot;</span>);
<a name="l01751"></a>01751   <a class="code" href="classSBMatrix.html">SBMatrix</a>      *Rpy_sCont= <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(NumTmp, NyAll, <span class="stringliteral">&quot;Rpy_sCont&quot;</span>);
<a name="l01752"></a>01752   <a class="code" href="classSBVector.html">SBVector</a>      *Zp_sCont = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(NumTmp, <span class="stringliteral">&quot;Zp_sCont&quot;</span>);
<a name="l01753"></a>01753 
<a name="l01754"></a>01754   <a class="code" href="classSBMatrix.html">SBMatrix</a>      *SRCont = <span class="keyword">new</span> <a class="code" href="classSBMatrix.html">SBMatrix</a>(n, m + 1, <span class="stringliteral">&quot;SRCont&quot;</span>);
<a name="l01755"></a>01755   <a class="code" href="classSBVector.html">SBVector</a>      *UCont  = <span class="keyword">new</span> <a class="code" href="classSBVector.html">SBVector</a>(n + 1, <span class="stringliteral">&quot;UCont&quot;</span>);
<a name="l01756"></a>01756 
<a name="l01757"></a>01757   <span class="comment">// fill the matrix SRCont:</span>
<a name="l01758"></a>01758   <span class="keywordflow">for</span> (i=0; i&lt;NumTmp; i++)
<a name="l01759"></a>01759     {
<a name="l01760"></a>01760       <a class="code" href="classSBParameter.html">SBParameter</a>      *p  = PsTmp-&gt;at(i);
<a name="l01761"></a>01761       <span class="keywordtype">double</span>            mm = p -&gt;<a class="code" href="classSBParameter.html#ad5f9a793710e750252144138b6e24d6f">m</a> (dT);
<a name="l01762"></a>01762       <span class="keywordtype">double</span>            rwn= p -&gt;<a class="code" href="classSBParameter.html#a619f8027c57d61e167d5a94e586fb030">rw</a>(dT);
<a name="l01763"></a>01763 
<a name="l01764"></a>01764       SRCont-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i,        i,   -mm*rwn);
<a name="l01765"></a>01765       SRCont-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, NumTmp+i,       rwn);
<a name="l01766"></a>01766 
<a name="l01767"></a>01767       SRCont-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(NumTmp+i, m, <a class="code" href="classSBEstimator.html#acdc81215f0e2648e157bdbbd1b981fa7">ZpCont</a>-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(*(Idx_POld+i)));
<a name="l01768"></a>01768 
<a name="l01769"></a>01769       <span class="keywordflow">for</span> (j=i; j&lt;NumTmp; j++) 
<a name="l01770"></a>01770         SRCont-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(NumTmp+i,  j,  <a class="code" href="classSBEstimator.html#aaddeaa5d35bd76467427e83102f4b1d4">RpCont</a> -&gt;<a class="code" href="classSBUpperMatrix.html#ab8aea8918435ff0e833da2724568a52d">at</a>(*(Idx_POld+i), *(Idx_POld+j)));
<a name="l01771"></a>01771 
<a name="l01772"></a>01772       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>;  j++)
<a name="l01773"></a>01773         SRCont-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(NumTmp+i, n+j, <a class="code" href="classSBEstimator.html#abadd54d3b5c6e135257fa9a220afa1da">RpyCont</a>-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(*(Idx_POld+i), j));
<a name="l01774"></a>01774     };
<a name="l01775"></a>01775 
<a name="l01776"></a>01776   <span class="comment">// make a Householder transformation</span>
<a name="l01777"></a>01777   <span class="comment">// this should be optimized too..</span>
<a name="l01778"></a>01778   <span class="keywordflow">for</span> (l=0; l&lt;n; l++)
<a name="l01779"></a>01779     {
<a name="l01780"></a>01780       <span class="keywordflow">for</span> (i=l, s=0.0; i&lt;n; i++) s+=SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l)*SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l);
<a name="l01781"></a>01781       <span class="keywordflow">if</span> (s&gt;0.0)
<a name="l01782"></a>01782         {
<a name="l01783"></a>01783           s = -<a class="code" href="SbGeo_8H.html#a8df1c56975179584e0485c5ddcb1e71b">sign</a>(SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,l))*sqrt(s);
<a name="l01784"></a>01784           UCont-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(l, SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(l,l) - s);                           <span class="comment">// U_l</span>
<a name="l01785"></a>01785           <span class="keywordflow">for</span> (i=l+1; i&lt;n; i++) UCont-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,l));         <span class="comment">// U_i (i=l+1, N)</span>
<a name="l01786"></a>01786           SRCont-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(l,l, s);
<a name="l01787"></a>01787           s = 1.0/(s*UCont-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(l));                                     <span class="comment">// betta</span>
<a name="l01788"></a>01788           <span class="keywordflow">for</span> (j=l+1; j&lt;m+1; j++)                                       <span class="comment">// |-------------------------</span>
<a name="l01789"></a>01789             {                                                           <span class="comment">// |</span>
<a name="l01790"></a>01790               <span class="keywordflow">for</span> (i=l,g=0.0; i&lt;n; i++) g+=UCont-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i)*SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,j);<span class="comment">// |</span>
<a name="l01791"></a>01791               <span class="keywordflow">for</span> (i=l; i&lt;n; i++) (*SRCont)(i,j)+=s*g*UCont-&gt;<a class="code" href="classSBVector.html#a7b92a42bdecf52a9814a2020c7cbc631">at</a>(i);     <span class="comment">// |</span>
<a name="l01792"></a>01792             };                                                          <span class="comment">// |_________________________</span>
<a name="l01793"></a>01793         };
<a name="l01794"></a>01794     };
<a name="l01795"></a>01795 
<a name="l01796"></a>01796   <span class="comment">// fill the matrices for smoothing and filtering:</span>
<a name="l01797"></a>01797   <span class="keywordflow">for</span> (i=0; i&lt;NumTmp; i++)
<a name="l01798"></a>01798     {      
<a name="l01799"></a>01799       <span class="keywordflow">for</span> (j=i; j&lt;NumTmp; j++)
<a name="l01800"></a>01800         {
<a name="l01801"></a>01801           Rp_sCont-&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(           i,             j,    SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(       i,        j));
<a name="l01802"></a>01802           <a class="code" href="classSBEstimator.html#ae8328bc93b550115e03a7d1f4fe6ed2b">Rp</a>      -&gt;<a class="code" href="classSBUpperMatrix.html#a43559afa2af6119ee17e1791a3773c30">set</a>(*(Idx_PNew+i), *(Idx_PNew+j),   SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(NumTmp+i, NumTmp+j));
<a name="l01803"></a>01803         };
<a name="l01804"></a>01804 
<a name="l01805"></a>01805       <span class="keywordflow">for</span> (j=0; j&lt;NumTmp; j++)
<a name="l01806"></a>01806         Rpp_sCont-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(i, j,                            SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(i,        NumTmp+j));
<a name="l01807"></a>01807 
<a name="l01808"></a>01808       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a326b6fff8c3b477823f3d90eb7741dd5">NyAll</a>; j++)
<a name="l01809"></a>01809         Rpy_sCont-&gt;<a class="code" href="classSBMatrix.html#a90dd8cbd4aaced88d1f61ed28dc1ba79">set</a>(           i,  j,        SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(       i,  n+j));
<a name="l01810"></a>01810 
<a name="l01811"></a>01811       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classSBEstimator.html#a4cfc2b3e770f63f8b5ab90188205df3e">Ny</a>; j++)
<a name="l01812"></a>01812         <a class="code" href="classSBEstimator.html#a398b8575d77a13c994d1b5289f21e6b2">Rpy</a>      -&gt;<span class="keyword">set</span>(*(Idx_PNew+i), j,        SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(NumTmp+i,  n+*(Idx_Y+j)));
<a name="l01813"></a>01813       
<a name="l01814"></a>01814       <a class="code" href="classSBEstimator.html#ad333190224c0410397d64802006e4709">Zp</a>      -&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(*(Idx_PNew+i), SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(NumTmp+i, m));
<a name="l01815"></a>01815       Zp_sCont-&gt;<a class="code" href="classSBVector.html#a50a8dd45ee61352c324dc20535f3b46d">set</a>(i, SRCont-&gt;<a class="code" href="classSBMatrix.html#a0de9a88e58ec059e05e048d25b76f0e0">at</a>(   i, m));
<a name="l01816"></a>01816     };
<a name="l01817"></a>01817 
<a name="l01818"></a>01818   <span class="comment">// save for smoothing:</span>
<a name="l01819"></a>01819   <span class="comment">// here BatchName is the name of previous batch still</span>
<a name="l01820"></a>01820   QFile f(<a class="code" href="classSBEstimator.html#aa98e94f97b818a1594fa52f33d788d55">workDir4Loc</a>(<a class="code" href="classSBEstimator.html#a5b4496ae3ef926ecf2c6973410edc3e3">BatchName</a>) + <span class="stringliteral">&quot;stochastics_aux.bin&quot;</span>);
<a name="l01821"></a>01821   <span class="keywordflow">if</span> (!f.open(IO_WriteOnly))
<a name="l01822"></a>01822     <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08ae392bcd014a917ef24fc1225292995b6">SBLog::ERR</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + <span class="stringliteral">&quot;: cannot open the file [&quot;</span> + f.name() + 
<a name="l01823"></a>01823                <span class="stringliteral">&quot;] for writting&quot;</span>);
<a name="l01824"></a>01824   QDataStream data_stream(&amp;f);
<a name="l01825"></a>01825   data_stream &lt;&lt; *PsTmp &lt;&lt; *Zp_sCont &lt;&lt; *Rp_sCont &lt;&lt; *Rpp_sCont &lt;&lt; *Rpy_sCont;
<a name="l01826"></a>01826   data_stream.unsetDevice();
<a name="l01827"></a>01827   f.close();
<a name="l01828"></a>01828 
<a name="l01829"></a>01829   <span class="keyword">delete</span> PsTmp;
<a name="l01830"></a>01830   <span class="keyword">delete</span> Rp_sCont;
<a name="l01831"></a>01831   <span class="keyword">delete</span> Rpp_sCont;
<a name="l01832"></a>01832   <span class="keyword">delete</span> Rpy_sCont;
<a name="l01833"></a>01833   <span class="keyword">delete</span> Zp_sCont;
<a name="l01834"></a>01834   <span class="keyword">delete</span> SRCont;
<a name="l01835"></a>01835   <span class="keyword">delete</span> UCont;
<a name="l01836"></a>01836 
<a name="l01837"></a>01837   <span class="keyword">delete</span>[] Idx_Y;
<a name="l01838"></a>01838   <span class="keyword">delete</span>[] Idx_PNew;
<a name="l01839"></a>01839   <span class="keyword">delete</span>[] Idx_POld;
<a name="l01840"></a>01840   
<a name="l01841"></a>01841   <a class="code" href="SbGeneral_8C.html#aef5cc75506f512b864a727ed8436ba80">Log</a>-&gt;<a class="code" href="classSBLog.html#a8c4ad11637bc0405bf28f0f29aa8a86a">write</a>(<a class="code" href="classSBLog.html#af729ae12fb4954f95e238b70db910f08a4d88517f1b07942f0b7f18c61e3585be">SBLog::DBG</a>, <a class="code" href="classSBLog.html#a1c3e29d096b460c80466ccde9380edf4aaacbb64f81ead8f168f90930426531d4">SBLog::ESTIMATOR</a>, <a class="code" href="classSBEstimator.html#a690e1fbe88158ab710a73509d4078835">ClassName</a>() + 
<a name="l01842"></a>01842              <span class="stringliteral">&quot;: `continuous&#39; stochastic parameters have been propagated for new batch&quot;</span>);
<a name="l01843"></a>01843 };
<a name="l01844"></a>01844 <span class="comment">/*==============================================================================================*/</span>
<a name="l01845"></a>01845 
<a name="l01846"></a>01846 
<a name="l01847"></a>01847 
<a name="l01848"></a>01848 <span class="comment">/*==============================================================================================*/</span>
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Mon May 14 2012 13:21:50 for SteelBreeze Reference Manual by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
